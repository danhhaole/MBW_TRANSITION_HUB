import{r,q as A,c as b,s as ue,C as L,e as c,f as _,b as x,v as _e,d as t,n as f,t as s,a as ge,h as v,F as U,i as M,j as y,u as h,o as d,x as me,X as R,k as pe,l as q,m as G,Q as he,z as be,Y as ve,Z as ye,L as xe}from"./index-d2648b45.js";const fe={class:"min-h-screen bg-gray-50"},we={class:"container mx-auto px-6 py-6"},ke={class:"flex items-center gap-2 mb-4"},Ce={class:"bg-white rounded-lg border border-gray-200"},Ee={key:1,class:"overflow-x-auto"},Se={class:"min-w-full divide-y divide-gray-200"},De={class:"bg-gray-50"},Te={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Ne={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Ae={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Le={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Pe={class:"bg-white divide-y divide-gray-200"},$e={class:"px-6 py-4"},Oe={class:"flex items-start gap-3"},Ve={class:"text-gray-900 font-medium"},Ue={class:"text-xs text-gray-500"},Me={class:"px-6 py-4"},je={class:"px-6 py-4"},ze={class:"px-6 py-4"},Ie={class:"flex items-center gap-2"},Fe=["onClick"],Be={key:0},Xe={colspan:"4",class:"px-6 py-8 text-center text-gray-500"},He={key:2,class:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6"},Je={class:"flex items-center justify-between"},Ke={class:"flex-1 flex justify-between sm:hidden"},Re=["disabled"],qe=["disabled"],Ge={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Qe={class:"text-sm text-gray-700"},Ye={class:"font-medium"},Ze={class:"font-medium"},We={class:"font-medium"},et={class:"relative z-0 inline-flex rounded-md -space-x-px","aria-label":"Pagination"},tt=["disabled"],at=["onClick"],st=["disabled"],nt={class:"p-6 space-y-6"},lt={key:0,class:"mb-2"},it={class:"flex items-center gap-3 mb-3"},ot={class:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 text-blue-600 font-semibold"},dt={class:"text-base font-semibold text-gray-900"},ct={class:"text-sm text-gray-600"},rt={class:"text-xs text-gray-500"},ut={class:"block text-sm font-medium text-gray-700 mb-3"},_t={class:"flex flex-wrap gap-2 mb-2"},gt=["onClick"],mt={class:"w-4 h-4 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20"},pt={key:0,"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},ht={key:1,d:"M4.555 5.168A1 1 0 003 6v8a1 1 0 001.555.832L10 11.202V14a1 1 0 001.555.832l6-4a1 1 0 000-1.664l-6-4A1 1 0 0010 6v2.798l-5.445-3.63z"},bt={key:2,"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},vt={class:"space-y-4"},yt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xt={class:"block text-sm font-medium text-gray-700 mb-1"},ft={class:"p-3 bg-gray-50 rounded-md text-sm"},wt={class:"block text-sm font-medium text-gray-700 mb-1"},kt={class:"p-3 bg-gray-50 rounded-md text-sm"},Ct={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Et={class:"block text-sm font-medium text-gray-700 mb-1"},St={class:"p-3 bg-gray-50 rounded-md text-sm"},Dt={class:"block text-sm font-medium text-gray-700 mb-1"},Tt={class:"p-3 bg-gray-50 rounded-md text-sm"},Nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},At={class:"block text-sm font-medium text-gray-700 mb-1"},Lt={class:"p-3 bg-gray-50 rounded-md text-sm"},Pt={class:"block text-sm font-medium text-gray-700 mb-1"},$t={class:"p-3 bg-gray-50 rounded-md text-sm"},Ot={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Vt={class:"block text-sm font-medium text-gray-700 mb-1"},Ut={class:"p-3 bg-gray-50 rounded-md text-sm"},Mt={class:"block text-sm font-medium text-gray-700 mb-1"},jt={class:"p-3 bg-gray-50 rounded-md text-sm"},zt={key:0},It={class:"block text-sm font-medium text-gray-700 mb-1"},Ft={class:"p-3 bg-gray-50 rounded-md text-sm"},Bt={class:"whitespace-pre-wrap text-xs"},Jt={__name:"MyActions",setup(Xt){const Q=[{label:__("My Tasks"),route:{name:"MyActions"}}],g=r("pending"),E=r(!1),j=r([]),z=r([]),I=r({pending:{},completed:{}}),P=he(),Y=A({url:"mbw_mira.mbw_mira.doctype.action.action.get_my_actions",method:"POST"}),w=r(1),F=r(10),k=async()=>{E.value=!0;try{const e=await Y.submit({page:w.value,limit:F.value,include_scheduled_as_pending:1,include_unassigned:1});e!=null&&e.success&&(j.value=e.pending||[],z.value=e.completed||[],I.value=e.pagination||{pending:{},completed:{}})}finally{E.value=!1}},B=b(()=>g.value==="pending"?j.value:z.value),l=b(()=>I.value[g.value]||{page:1,limit:F.value,total:0}),Z=b(()=>l.value.total===0?0:(l.value.page-1)*l.value.limit+1),W=b(()=>Math.min(l.value.page*l.value.limit,l.value.total||0)),ee=b(()=>l.value.pages||(l.value.total&&l.value.limit?Math.ceil(l.value.total/l.value.limit):1)),te=b(()=>{const e=ee.value,n=l.value.page||1,i=2,a=[];for(let u=Math.max(1,n-i);u<=Math.min(e,n+i);u++)a.push(u);return a.includes(1)||a.unshift(1),a.includes(e)||a.push(e),Array.from(new Set(a)).filter(u=>u>=1&&u<=e)}),X=e=>{g.value=e},H=()=>{l.value.has_next&&(w.value++,k())},J=()=>{l.value.has_prev&&w.value>1&&(w.value--,k())},ae=e=>{e&&e!==l.value.page&&(w.value=e,k())},S=e=>e==="PENDING_MANUAL"||e==="SCHEDULED"?"Đang chờ":e==="EXECUTED"?"Hoàn thành":e,K=e=>({"Đang chờ":"bg-yellow-100 text-yellow-800","Hoàn thành":"bg-green-100 text-green-800"})[e]||"bg-gray-100 text-gray-800",D=e=>e?new Date(e).toLocaleString():"";ue(k);const C=r(!1),$=r(!1),O=L({name:"",talent_campaign_id:"",campaign_step:"",status:"PENDING_MANUAL",assignee_id:"",scheduled_at:"",executed_at:"",result:""}),m=L({}),p=r(""),T=r(""),se=e=>({PENDING_MANUAL:__("Pending Manual"),SCHEDULED:__("Scheduled"),EXECUTED:__("Executed"),SKIPPED:__("Skipped"),FAILED:__("Failed")})[e]||e,ne=b(()=>[{value:"EXECUTED",label:__("Complete"),color:"success",icon:"mdi-check-circle"},{value:"SKIPPED",label:__("Skip"),color:"warning",icon:"mdi-skip-next"},{value:"FAILED",label:__("Failed"),color:"error",icon:"mdi-alert-circle"}]),le=e=>({success:"bg-green-100 text-green-800 border border-green-300",info:"bg-blue-100 text-blue-800 border border-blue-300",warning:"bg-yellow-100 text-yellow-800 border border-yellow-300",error:"bg-red-100 text-red-800 border border-red-300"})[e]||"bg-blue-100 text-blue-800 border border-blue-300",V=r(!1),o=L({}),N=L({candidateCampaigns:[],campaignSteps:[],assignees:[]}),ie=async()=>{try{const e=await be.getList({fields:["name","talent_id","campaign_id"],page_length:1e3});e.success&&(N.candidateCampaigns=e.data.map(a=>({label:`${a.name} (${a.talent_id} - ${a.campaign_id})`,value:a.name})));const n=await ve.getList({fields:["name","campaign_step_name","campaign"],page_length:1e3});n.success&&(N.campaignSteps=n.data.map(a=>({label:`${a.campaign_step_name} (${a.campaign})`,value:a.name,campaign:a.campaign})));const i=await ye.getList({fields:["name","full_name","email"],page_length:1e3});i.success&&(N.assignees=i.data.map(a=>({label:`${a.full_name} (${a.email})`,value:a.name})))}catch{}},oe=async e=>{try{const i=await A({url:"mbw_mira.api.common.get_form_data",method:"POST"}).submit({doctype:"Action",name:e.name}),a=(i==null?void 0:i.data)||{};Object.assign(o,{...e,...a,campaign_step_name:a.campaign_step_name||e.campaign_step_name||e.campaign_step,campaign_name:a.campaign_name||e.campaign_name,assignee_name:a.assignee_name||e.assignee_name})}catch{Object.assign(o,{...e,campaign_step_name:e.campaign_step_name||e.campaign_step,campaign_name:e.campaign_name,assignee_name:e.assignee_name})}V.value=!0},de=async e=>{N.candidateCampaigns.length||await ie();try{const i=await A({url:"mbw_mira.api.common.get_form_data",method:"POST"}).submit({doctype:"Action",name:e.name}),a=(i==null?void 0:i.data)||{};Object.assign(O,{name:a.name||e.name,talent_campaign_id:a.talent_campaign_id||e.talent_campaign_id,campaign_step:a.campaign_step||e.campaign_step,status:a.status||e.status,assignee_id:a.assignee_id||e.assignee_id||"",scheduled_at:a.scheduled_at?String(a.scheduled_at).substring(0,16):e.scheduled_at?e.scheduled_at.substring(0,16):"",executed_at:a.executed_at?String(a.executed_at).substring(0,16):e.executed_at?e.executed_at.substring(0,16):"",result:a.result?typeof a.result=="string"?a.result:JSON.stringify(a.result):e.result?typeof e.result=="string"?e.result:JSON.stringify(e.result):""}),Object.assign(m,{candidate:a.candidate_name||e.candidate_name,campaign_name:a.campaign_name||e.campaign_name,status:a.status||e.status})}catch{Object.assign(O,{name:e.name,talent_campaign_id:e.talent_campaign_id,campaign_step:e.campaign_step,status:e.status,assignee_id:e.assignee_id||"",scheduled_at:e.scheduled_at?e.scheduled_at.substring(0,16):"",executed_at:e.executed_at?e.executed_at.substring(0,16):"",result:e.result?typeof e.result=="string"?e.result:JSON.stringify(e.result):""}),Object.assign(m,{candidate:e.candidate_name,campaign_name:e.campaign_name,status:e.status})}p.value="",T.value="",C.value=!0},ce=()=>__("Update Task"),re=async()=>{if(p.value){$.value=!0;try{const e=A({url:"mbw_mira.mbw_mira.doctype.action.action.update_action",method:"POST"}),n={name:O.name,status:p.value,executed_at:p.value==="EXECUTED"?new Date().toISOString():null,result:T.value||""},i=await e.submit(n);i!=null&&i.success?(P.success(__("Cập nhật hành động thành công")),C.value=!1,await k(),p.value==="EXECUTED"&&(g.value="completed")):P.error((i==null?void 0:i.error)||__("Cập nhật thất bại"))}catch(e){P.error(e.message||__("Cập nhật thất bại"))}finally{$.value=!1}}};return(e,n)=>{const i=xe;return d(),c("div",fe,[_(_e,null,{"left-header":x(()=>[_(h(me),{items:Q})]),_:1}),t("div",we,[t("div",ke,[t("button",{class:f(["px-3 py-1.5 rounded-md text-sm",g.value==="pending"?"bg-black text-white":"bg-white text-gray-700 border hover:text-gray-900"]),onClick:n[0]||(n[0]=a=>X("pending"))},s(e.__("All tasks")),3),t("button",{class:f(["px-3 py-1.5 rounded-md text-sm",g.value==="completed"?"bg-black text-white":"bg-white text-gray-700 border hover:text-gray-900"]),onClick:n[1]||(n[1]=a=>X("completed"))},s(e.__("Done")),3)]),t("div",Ce,[E.value?(d(),ge(i,{key:0,text:"Loading actions..."})):v("",!0),E.value?v("",!0):(d(),c("div",Ee,[t("table",Se,[t("thead",De,[t("tr",null,[t("th",Te,s(e.__("Tên công việc")),1),t("th",Ne,s(e.__("Trạng thái")),1),t("th",Ae,s(e.__("Ngày tạo")),1),t("th",Le,s(e.__("Thao tác")),1)])]),t("tbody",Pe,[(d(!0),c(U,null,M(B.value,a=>(d(),c("tr",{key:a.name,class:"hover:bg-gray-50"},[t("td",$e,[t("div",Oe,[n[6]||(n[6]=t("div",{class:"mt-2"},[t("svg",{viewBox:"0 0 24 24",width:"16",height:"24",stroke:"currentColor","stroke-width":"2",fill:"none","stroke-linecap":"round","stroke-linejoin":"round",class:"css-i6dzq1 text-blue-500"},[t("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),t("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})])],-1)),t("div",null,[t("div",Ve,s(a.campaign_step_name||a.campaign_step),1),t("div",Ue,s(a.campaign_name),1)])])]),t("td",Me,[t("span",{class:f([K(S(a.status)),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},s(S(a.status)),3)]),t("td",je,s(D(a.creation)),1),t("td",ze,[t("div",Ie,[t("button",{class:"inline-flex items-center px-3 py-1.5 rounded-md text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",onClick:u=>g.value==="completed"?oe(a):de(a)},s(g.value==="completed"?e.__("Xem chi tiết"):e.__("Cập nhật")),9,Fe)])])]))),128)),B.value.length===0?(d(),c("tr",Be,[t("td",Xe,s(e.__("Không có dữ liệu")),1)])):v("",!0)])])])),l.value&&l.value.total>l.value.limit?(d(),c("div",He,[t("div",Je,[t("div",Ke,[t("button",{onClick:J,disabled:!l.value.has_prev,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},s(e.__("Previous")),9,Re),t("button",{onClick:H,disabled:!l.value.has_next,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},s(e.__("Next")),9,qe)]),t("div",Ge,[t("div",null,[t("p",Qe,[y(s(e.__("Showing"))+" ",1),t("span",Ye,s(Z.value),1),y(" "+s(e.__("to"))+" ",1),t("span",Ze,s(W.value),1),y(" "+s(e.__("of"))+" ",1),t("span",We,s(l.value.total),1),y(" "+s(e.__("results")),1)])]),t("div",null,[t("nav",et,[t("button",{onClick:J,disabled:!l.value.has_prev,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[_(h(R),{name:"chevron-left",class:"w-5 h-5"})],8,tt),(d(!0),c(U,null,M(te.value,a=>(d(),c("button",{key:a,onClick:u=>ae(a),class:f(["relative inline-flex items-center px-4 py-2 border text-sm font-medium",a===l.value.page?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"])},s(a),11,at))),128)),t("button",{onClick:H,disabled:!l.value.has_next,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[_(h(R),{name:"chevron-right",class:"w-5 h-5"})],8,st)])])])])])):v("",!0)]),_(h(G),{modelValue:C.value,"onUpdate:modelValue":n[4]||(n[4]=a=>C.value=a),options:{title:e.__("Chỉnh sửa hành động"),size:"xl"}},{"body-content":x(()=>[t("div",nt,[m?(d(),c("div",lt,[t("div",it,[t("div",ot,s((m.candidate||"U").charAt(0).toUpperCase()),1),t("div",null,[t("div",dt,s(m.candidate||m.assignee_name||e.__("Task")),1),t("div",ct,s(e.__("Campaign"))+": "+s(m.campaign_name||"-"),1),t("div",rt,s(e.__("Current status"))+": "+s(se(m.status)),1)])])])):v("",!0),t("div",null,[t("label",ut,s(e.__("Update status"))+":",1),t("div",_t,[(d(!0),c(U,null,M(ne.value,a=>(d(),c("button",{key:a.value,class:f(["inline-flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200",p.value===a.value?le(a.color):"bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-300"]),onClick:u=>p.value=a.value},[(d(),c("svg",mt,[a.icon==="mdi-check-circle"?(d(),c("path",pt)):a.icon==="mdi-skip-next"?(d(),c("path",ht)):a.icon==="mdi-alert-circle"?(d(),c("path",bt)):v("",!0)])),y(" "+s(a.label),1)],10,gt))),128))])]),t("div",null,[_(h(pe),{modelValue:T.value,"onUpdate:modelValue":n[2]||(n[2]=a=>T.value=a),type:"textarea",label:e.__("Notes"),placeholder:e.__("Enter notes about the task execution..."),rows:3},null,8,["modelValue","label","placeholder"])])])]),actions:x(()=>[_(h(q),{variant:"ghost",onClick:n[3]||(n[3]=a=>C.value=!1)},{default:x(()=>[y(s(e.__("Cancel")),1)]),_:1}),_(h(q),{variant:"solid",disabled:!p.value,loading:$.value,onClick:re},{default:x(()=>[y(s(ce()),1)]),_:1},8,["disabled","loading"])]),_:1},8,["modelValue","options"]),_(h(G),{modelValue:V.value,"onUpdate:modelValue":n[5]||(n[5]=a=>V.value=a),options:{title:e.__("Chi tiết hành động"),size:"xl"}},{"body-content":x(()=>[t("div",vt,[t("div",yt,[t("div",null,[t("label",xt,s(e.__("Task name")),1),t("div",ft,s(o.campaign_step_name||o.campaign_step||"-"),1)]),t("div",null,[t("label",wt,s(e.__("Chiến dịch")),1),t("div",kt,s(o.campaign_name||"-"),1)])]),t("div",Ct,[t("div",null,[t("label",Et,s(e.__("Trạng thái")),1),t("div",St,[t("span",{class:f([K(S(o.status)),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},s(S(o.status)),3)])]),t("div",null,[t("label",Dt,s(e.__("Người được giao")),1),t("div",Tt,s(o.assignee_name||"-"),1)])]),t("div",Nt,[t("div",null,[t("label",At,s(e.__("Ngày tạo")),1),t("div",Lt,s(D(o.creation)),1)]),t("div",null,[t("label",Pt,s(e.__("Dự kiến tại")),1),t("div",$t,s(o.scheduled_at?D(o.scheduled_at):"-"),1)])]),t("div",Ot,[t("div",null,[t("label",Vt,s(e.__("Thực hiện tại")),1),t("div",Ut,s(o.executed_at?D(o.executed_at):"-"),1)]),t("div",null,[t("label",Mt,s(e.__("Loại hành động")),1),t("div",jt,s(o.action_type||"-"),1)])]),o.result?(d(),c("div",zt,[t("label",It,s(e.__("Kết quả")),1),t("div",Ft,[t("pre",Bt,s(typeof o.result=="string"?o.result:JSON.stringify(o.result,null,2)),1)])])):v("",!0)])]),_:1},8,["modelValue","options"])])])}}};export{Jt as default};
//# sourceMappingURL=MyActions-904f42b9.js.map
