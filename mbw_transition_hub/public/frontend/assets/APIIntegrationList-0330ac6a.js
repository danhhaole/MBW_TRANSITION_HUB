import{_ as be,r as S,a8 as ge,a9 as Ve,c as K,w as _e,s as ve,a1 as fe,U as Je,o as y,e as v,d as e,f as r,u as l,X as k,t as s,k as w,F as Q,i as X,a as D,b,j as x,h as $,l as O,D as L,a4 as me,n as de,W as Z,Q as Fe,C as xe,E as ye,aa as we,ab as G,ac as Qe,ad as ce,ae as je,m as $e}from"./index-d2648b45.js";const Xe={class:"facebook-connection-form"},et={class:"flex items-center gap-4 p-4 bg-blue-50 rounded-lg mb-6"},tt={class:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center"},st={class:"font-semibold text-gray-900"},nt={class:"text-sm text-gray-600"},ot={class:"space-y-6"},at={class:"space-y-4"},lt={class:"font-medium text-gray-900 border-b pb-2"},it={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},rt={key:0,class:"space-y-4"},ct={class:"font-medium text-gray-900 border-b pb-2"},dt={class:"bg-green-50 rounded-lg p-4"},ut={class:"flex items-center gap-2 mb-3"},_t={class:"font-medium text-green-800"},mt={class:"space-y-2"},gt={class:"flex items-center gap-3"},pt={class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},yt={class:"font-medium text-gray-900"},ft={class:"text-xs text-gray-500"},bt={class:"flex items-center gap-2"},vt={class:"space-y-4"},ht={class:"flex items-center justify-between border-b pb-2"},kt={class:"font-medium text-gray-900"},Ct={key:0,class:"bg-gray-50 rounded-lg p-4 space-y-3"},xt={class:"font-medium text-gray-800"},wt={class:"text-sm text-gray-700 space-y-2 list-decimal list-inside"},$t={class:"text-xs text-gray-600 bg-white p-2 rounded border"},Vt={class:"bg-blue-50 rounded-lg p-4"},At={class:"flex items-start gap-3"},Et={class:"font-medium text-blue-900"},St={class:"text-sm text-blue-700 mt-1"},Tt={key:1,class:"space-y-4"},Ot={class:"font-medium text-gray-900 border-b pb-2"},Ut={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},jt={class:"flex items-center space-x-3"},Pt={for:"auto-sync",class:"text-sm"},Ft={class:"font-medium text-gray-900"},qt={class:"block text-xs text-gray-500"},Dt={key:2,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},zt={class:"flex items-center justify-between"},Rt={class:"font-medium text-gray-900"},It={class:"text-sm text-gray-600"},Mt={class:"flex items-center gap-2"},Lt={class:"flex justify-between items-center pt-6 border-t"},Bt={class:"flex gap-3"},Nt={__name:"FacebookConnectionForm",props:{modelValue:{type:Object,default:()=>({})},platform:{type:Object,required:!0},isEdit:{type:Boolean,default:!1},existingConnection:{type:Object,default:()=>({})},connectedAccounts:{type:Array,default:()=>[]}},emits:["update:modelValue","submit","cancel"],setup(j,{emit:ne}){var _,A;const f=j,z=ne,{warning:p}=Fe(),oe=S(!1),h=S(!1),M=S(!1),R=S(!1),T=ge(null),V=S({}),{userResource:q,allUsers:F,getUser:m}=Ve(),o={tenant_name:"",user_email:(_=m==null?void 0:m.data)==null?void 0:_.email,full_name:(A=m==null?void 0:m.data)==null?void 0:A.full_name,hook_url:"",redirect_url:"",timeout:30,max_retries:3,permissions:["pages_manage_posts","pages_read_engagement"],auto_sync_accounts:!0},a=S({...o});__("Manage Page Posts"),__("Create, edit and delete posts on connected pages"),__("Read Page Engagement"),__("View likes, comments, and engagement metrics"),__("List Pages"),__("Access list of pages user manages"),__("Manage Page Info"),__("Update page information and settings"),__("Read User Content"),__("Read content posted by users on pages");const d=K(()=>{const t=a.value.redirect_url;console.log(t);const g=`${window.location.origin}/api/auth/facebook/callback`;return console.log(g),a.value.redirect_url||`${window.location.origin}/api/auth/facebook/callback`}),I=K(()=>{const t=a.value;return!!(t.user_email&&t.full_name&&B(t.user_email)&&Object.keys(V.value).length===0)}),B=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),N=()=>{const t={},g=a.value;return g.user_email?B(g.user_email)||(t.user_email=__("Please enter a valid email address")):t.user_email=__("Email is required"),g.full_name||(t.full_name=__("Full name is required")),g.hook_url&&!ae(g.hook_url)&&(t.hook_url=__("Please enter a valid URL")),g.timeout&&(g.timeout<5||g.timeout>300)&&(t.timeout=__("Timeout should be between 5 and 300 seconds")),g.max_retries&&(g.max_retries<1||g.max_retries>10)&&(t.max_retries=__("Max retries should be between 1 and 10")),V.value=t,Object.keys(t).length===0},ae=t=>{try{return new URL(t),!0}catch{return!1}},le=()=>{R.value=!R.value},ee=async()=>{if(!I.value){p(`${__("Validation Error")}: ${__("Please fix form errors before testing")}`);return}h.value=!0,T.value=null;try{const t=await Z("mbw_transition_hub.api.external_connections.test_connection",{connection_id:f.existingConnection.connection_id||f.existingConnection.name}),g=(t==null?void 0:t.message)||t;g!=null&&g.success?T.value={success:!0,message:(g==null?void 0:g.message)||__("Connection test successful! Facebook OAuth is configured properly.")}:T.value={success:!1,message:(g==null?void 0:g.message)||__("Connection test failed")}}catch(t){console.error("Connection test error:",t),T.value={success:!1,message:t.message||__("Failed to test connection")}}finally{h.value=!1}},W=async()=>{if(!N()){p(`${__("Validation Error")}: ${__("Please fix the errors in the form")}`);return}oe.value=!0;try{const t={tenant_name:a.value.tenant_name,user_email:a.value.user_email,full_name:a.value.full_name,app_id:a.value.app_id,app_secret:a.value.app_secret,hook_url:a.value.hook_url||"",redirect_url:d.value,api_version:a.value.api_version||"v18.0",timeout:parseInt(a.value.timeout)||30,permissions:[...a.value.permissions],auto_sync_accounts:a.value.auto_sync_accounts,platform_type:"Facebook"};z("submit",t)}catch(t){console.error("Form submission error:",t),p(`${__("Error")}: ${t.message||__("Failed to submit form")}`)}finally{oe.value=!1}},Y=()=>{f.isEdit&&f.existingConnection?te():Object.assign(a.value,{...o}),V.value={},T.value=null,z("cancel")},H=()=>{fe(()=>{z("update:modelValue",{...a.value})})},te=()=>{if(f.existingConnection){const t=f.existingConnection;Object.assign(a.value,{tenant_name:t.tenant_name||"",user_email:t.user_email||"",full_name:t.full_name||"",hook_url:t.hook_url||"",redirect_url:t.redirect_url||d.value,timeout:t.timeout||30,max_retries:t.max_retries||3,permissions:t.permissions||[...o.permissions],auto_sync_accounts:t.auto_sync_accounts??!0})}};let J=null;return _e(a,()=>{J&&clearTimeout(J),J=setTimeout(()=>{N(),H()},300)},{deep:!0,flush:"post"}),_e(()=>f.modelValue,t=>{if(t&&typeof t=="object"){const g=JSON.stringify(a.value),se=JSON.stringify({...o,...t});g!==se&&Object.assign(a.value,{...o,...t})}},{immediate:!1,deep:!0}),ve(()=>{f.isEdit&&f.existingConnection?te():f.modelValue&&Object.keys(f.modelValue).length>0&&Object.assign(a.value,{...o,...f.modelValue}),a.value.redirect_url||(a.value.redirect_url=d.value),fe(()=>{N(),H()})}),(t,g)=>{var ue,ie,C;const se=Je("Badge");return y(),v("div",Xe,[e("div",et,[e("div",tt,[r(l(k),{name:"facebook",class:"w-6 h-6 text-white"})]),e("div",null,[e("h3",st,s(t.__("Facebook Integration")),1),e("p",nt,s(j.isEdit?t.__("Update your Facebook connection settings"):t.__("Connect your Facebook account to manage pages and posts")),1)])]),e("div",ot,[e("div",at,[e("h4",lt,s(t.__("Basic Information")),1),e("div",it,[r(l(w),{label:t.__("User Email"),type:"email",modelValue:a.value.user_email,"onUpdate:modelValue":g[0]||(g[0]=U=>a.value.user_email=U),placeholder:t.__("your-email@domain.com"),required:!0,error:V.value.user_email},null,8,["label","modelValue","placeholder","error"])]),r(l(w),{label:t.__("Full Name"),modelValue:a.value.full_name,"onUpdate:modelValue":g[1]||(g[1]=U=>a.value.full_name=U),placeholder:t.__("Your full name"),required:!0,error:V.value.full_name},null,8,["label","modelValue","placeholder","error"])]),j.isEdit&&(f.connectedAccounts.length>0||((ie=(ue=f.existingConnection)==null?void 0:ue.accounts)==null?void 0:ie.length)>0)?(y(),v("div",rt,[e("h4",ct,s(t.__("Connected Accounts")),1),e("div",dt,[e("div",ut,[r(l(k),{name:"check-circle",class:"w-5 h-5 text-green-600"}),e("h5",_t,s(t.__("Active Facebook Accounts")),1)]),e("div",mt,[(y(!0),v(Q,null,X(f.connectedAccounts.length>0?f.connectedAccounts:((C=f.existingConnection)==null?void 0:C.accounts)||[],U=>(y(),v("div",{key:U.external_account_id,class:"flex items-center justify-between p-3 bg-white rounded border"},[e("div",gt,[e("div",pt,[r(l(k),{name:"facebook",class:"w-4 h-4 text-blue-600"})]),e("div",null,[e("div",yt,s(U.account_name),1),e("div",ft,s(U.account_type)+" • ID: "+s(U.external_account_id),1)])]),e("div",bt,[U.is_primary?(y(),D(se,{key:0,variant:"success",size:"sm"},{default:b(()=>[x(s(t.__("Primary")),1)]),_:1})):$("",!0),r(se,{variant:U.is_active?"success":"gray",size:"sm"},{default:b(()=>[x(s(U.is_active?t.__("Active"):t.__("Inactive")),1)]),_:2},1032,["variant"])])]))),128))])])])):$("",!0),e("div",vt,[e("div",ht,[e("h4",kt,s(t.__("OAuth Configuration")),1),r(l(O),{onClick:g[2]||(g[2]=U=>M.value=!M.value),variant:"ghost",size:"sm"},{prefix:b(()=>[r(l(k),{name:"help-circle",class:"w-4 h-4"})]),default:b(()=>[x(" "+s(t.__("Setup Guide")),1)]),_:1})]),M.value?(y(),v("div",Ct,[e("h5",xt,s(t.__("OAuth Setup Instructions:")),1),e("ol",wt,[e("li",null,s(t.__("Contact system administrator for OAuth configuration")),1),e("li",null,s(t.__("Your organization's Facebook App will be configured centrally")),1),e("li",null,s(t.__("Connection will be established through secure OAuth flow")),1),e("li",null,s(t.__("No sensitive credentials need to be entered manually")),1)]),e("div",$t,[e("strong",null,s(t.__("Callback URL:")),1),x(" "+s(d.value),1)])])):$("",!0),e("div",Vt,[e("div",At,[r(l(k),{name:"shield-check",class:"w-5 h-5 text-blue-600 mt-0.5"}),e("div",null,[e("h5",Et,s(t.__("Secure OAuth Connection")),1),e("p",St,s(t.__("This connection uses OAuth 2.0 for secure authentication. Your Facebook credentials are never stored on our servers.")),1)])])])]),R.value?(y(),v("div",Tt,[e("h4",Ot,s(t.__("Advanced Settings")),1),e("div",Ut,[r(l(w),{label:t.__("Connection Timeout (seconds)"),type:"number",modelValue:a.value.timeout,"onUpdate:modelValue":g[3]||(g[3]=U=>a.value.timeout=U),placeholder:t.__("30"),error:V.value.timeout},null,8,["label","modelValue","placeholder","error"]),r(l(w),{label:t.__("Max Retry Attempts"),type:"number",modelValue:a.value.max_retries,"onUpdate:modelValue":g[4]||(g[4]=U=>a.value.max_retries=U),placeholder:t.__("3"),error:V.value.max_retries},null,8,["label","modelValue","placeholder","error"])]),e("div",jt,[L(e("input",{id:"auto-sync",type:"checkbox","onUpdate:modelValue":g[5]||(g[5]=U=>a.value.auto_sync_accounts=U),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[me,a.value.auto_sync_accounts]]),e("label",Pt,[e("span",Ft,s(t.__("Auto-sync accounts")),1),e("span",qt,s(t.__("Automatically sync Facebook pages and accounts")),1)])])])):$("",!0),j.isEdit?(y(),v("div",Dt,[e("div",zt,[e("div",null,[e("h5",Rt,s(t.__("Test Connection")),1),e("p",It,s(t.__("Verify that your Facebook connection is working")),1)]),r(l(O),{onClick:ee,variant:"outline",size:"sm",loading:h.value},{prefix:b(()=>[r(l(k),{name:"zap",class:"w-4 h-4"})]),default:b(()=>[x(" "+s(t.__("Test")),1)]),_:1},8,["loading"])]),T.value?(y(),v("div",{key:0,class:de(["mt-3 p-3 rounded border",T.value.success?"border-green-200 bg-green-50":"border-red-200 bg-red-50"])},[e("div",Mt,[r(l(k),{name:T.value.success?"check-circle":"x-circle",class:de(["w-4 h-4",T.value.success?"text-green-600":"text-red-600"])},null,8,["name","class"]),e("span",{class:de(["text-sm font-medium",T.value.success?"text-green-800":"text-red-800"])},s(T.value.message),3)])],2)):$("",!0)])):$("",!0)]),e("div",Lt,[r(l(O),{onClick:le,variant:"ghost",size:"sm"},{default:b(()=>[x(s(R.value?t.__("Hide"):t.__("Show"))+" "+s(t.__("Advanced Settings")),1)]),_:1}),e("div",Bt,[r(l(O),{onClick:Y,variant:"ghost"},{default:b(()=>[x(s(t.__("Cancel")),1)]),_:1}),r(l(O),{onClick:W,variant:"solid",loading:oe.value,disabled:!I.value},{default:b(()=>[x(s(j.isEdit?t.__("Update Connection"):t.__("Connect Facebook")),1)]),_:1},8,["loading","disabled"])])])])}}},Pe=be(Nt,[["__scopeId","data-v-935719d3"]]);const Ht={class:"zalo-connection-form p-4"},Zt={key:0,class:"space-y-6"},Gt={class:"flex items-center p-4 bg-blue-50 rounded-lg"},Kt={class:"font-medium text-blue-900"},Wt={class:"text-sm text-blue-700"},Yt={class:"space-y-4"},Jt={class:"font-medium text-gray-900 border-b pb-2"},Qt={class:"grid grid-cols-1 gap-4"},Xt={class:"block text-sm font-medium text-gray-700 mb-2"},es=["placeholder"],ts={class:"block text-sm font-medium text-gray-700 mb-2"},ss=["placeholder"],ns={class:"space-y-4"},os={class:"font-medium text-gray-900 border-b pb-2"},as={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-3"},ls={class:"flex items-start"},is={class:"text-sm text-yellow-800"},rs={class:"font-medium mb-1"},cs={class:"space-y-4"},ds={class:"font-medium text-gray-900 border-b pb-2"},us={class:"flex items-center space-x-2"},_s={for:"enable-broadcasting",class:"text-sm text-gray-700"},ms={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},gs={class:"block text-sm font-medium text-gray-700 mb-2"},ps={class:"text-xs text-gray-500 mt-1"},ys={class:"block text-sm font-medium text-gray-700 mb-2"},fs={value:"high"},bs={value:"normal"},vs={value:"low"},hs={class:"space-y-4"},ks={class:"font-medium text-gray-900 border-b pb-2"},Cs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xs={class:"block text-sm font-medium text-gray-700 mb-2"},ws={value:"Hourly"},$s={value:"Every 5 minutes"},Vs={value:"Every 15 minutes"},As={value:"Every 30 minutes"},Es={value:"Daily"},Ss={value:"Real-time"},Ts={class:"block text-sm font-medium text-gray-700 mb-2"},Os={class:"flex items-center space-x-2"},Us={for:"debug-mode",class:"text-sm text-gray-700"},js={class:"space-y-4"},Ps={class:"font-medium text-gray-900 border-b pb-2"},Fs={class:"bg-blue-50 rounded-lg p-4"},qs={class:"text-sm text-blue-900 mb-3"},Ds={class:"grid grid-cols-1 gap-3"},zs={class:"text-sm font-medium text-gray-900"},Rs={class:"text-xs text-gray-600"},Is={key:1,class:"space-y-6"},Ms={class:"flex items-center p-4 bg-green-50 rounded-lg"},Ls={class:"flex-1"},Bs={class:"font-medium text-green-900"},Ns={class:"text-sm text-green-700"},Hs={class:"text-xs text-green-600 mt-1"},Zs={class:"text-xs text-green-600"},Gs={class:"space-y-4"},Ks={class:"font-medium text-gray-900 border-b pb-2"},Ws={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ys={class:"bg-white border border-gray-200 rounded-lg p-4"},Js={class:"flex items-center space-x-3 mb-3"},Qs={class:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center"},Xs={class:"font-medium text-gray-900"},en={class:"text-sm text-gray-600"},tn={class:"space-y-2 text-sm"},sn={class:"flex justify-between"},nn={class:"text-gray-600"},on={class:"font-mono"},an={class:"flex justify-between"},ln={class:"text-gray-600"},rn={class:"bg-white border border-gray-200 rounded-lg p-4"},cn={class:"font-medium text-gray-900 mb-3"},dn={class:"space-y-2 text-sm"},un={class:"flex justify-between"},_n={class:"text-gray-600"},mn={class:"font-semibold"},gn={class:"flex justify-between"},pn={class:"text-gray-600"},yn={class:"font-semibold"},fn={class:"flex justify-between"},bn={class:"text-gray-600"},vn={class:"font-semibold"},hn={class:"space-y-4"},kn={class:"flex items-center justify-between"},Cn={class:"font-medium text-gray-900"},xn={key:0,class:"space-y-3"},wn={class:"flex items-center space-x-3"},$n={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},Vn={class:"font-medium text-gray-900"},An={class:"text-sm text-gray-600"},En={class:"flex items-center space-x-2"},Sn={key:1,class:"text-center py-8"},Tn={class:"text-lg font-medium text-gray-900 mb-2"},On={class:"text-gray-600 mb-4"},Un={class:"space-y-4"},jn={class:"font-medium text-gray-900 border-b pb-2"},Pn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fn={class:"block text-sm font-medium text-gray-700 mb-2"},qn={value:"Hourly"},Dn={value:"Every 5 minutes"},zn={value:"Every 15 minutes"},Rn={value:"Every 30 minutes"},In={value:"Daily"},Mn={value:"Real-time"},Ln={class:"block text-sm font-medium text-gray-700 mb-2"},Bn={class:"space-y-3"},Nn={class:"flex items-center space-x-2"},Hn={for:"enable-broadcasting-edit",class:"text-sm text-gray-700"},Zn={class:"flex items-center space-x-2"},Gn={for:"auto-sync-templates",class:"text-sm text-gray-700"},Kn={class:"flex items-center space-x-2"},Wn={for:"debug-mode-edit",class:"text-sm text-gray-700"},Yn={class:"space-y-4 pt-6 border-t border-red-200"},Jn={class:"font-medium text-red-900"},Qn={class:"bg-red-50 border border-red-200 rounded-lg p-4"},Xn={class:"flex items-start"},eo={class:"flex-1"},to={class:"font-medium text-red-900"},so={class:"text-sm text-red-700 mt-1"},no={class:"flex justify-end space-x-3 pt-6 border-t"},oo={__name:"ZaloConnectionForm",props:{platform:{type:Object,required:!0},connectionType:{type:String,required:!0},isEdit:{type:Boolean,default:!1},existingConnection:{type:Object,default:null},modelValue:{type:Object,default:()=>({})}},emits:["submit","cancel","update:modelValue"],setup(j,{emit:ne}){var _,A;const f=j,z=ne,{userResource:p,allUsers:oe,getUser:h}=Ve(),M=S(!1),R=S(!1),T=S(!1),V=S([]),q=S({}),F=S({}),m=xe({tenant_name:"",user_email:(_=h==null?void 0:h.data)==null?void 0:_.email,full_name:(A=h==null?void 0:h.data)==null?void 0:A.full_name,hook_url:"",redirect_url:"",enable_broadcasting:!0,daily_message_limit:1e3,message_priority:"normal",sync_frequency:"Hourly",max_retries:3,debug_mode:!1,auto_sync_templates:!0}),o=K(()=>`${window.location.origin}/api/method/mbw_transition_hub.api.external_connections.handle_webhook`),a=K(()=>`${window.location.origin}/mbw_transition_hub/connectors`),d=K(()=>f.isEdit?!0:m.user_email&&m.full_name&&m.hook_url&&m.redirect_url),I=[{label:__("Thông tin OA"),value:"oa_info",description:__("Truy cập thông tin cơ bản của Official Account")},{label:__("Gửi tin nhắn"),value:"send_message",description:__("Gửi tin nhắn đến người dùng")},{label:__("Quản lý followers"),value:"manage_followers",description:__("Truy cập và quản lý danh sách người theo dõi")},{label:__("Broadcast messages"),value:"broadcast",description:__("Gửi tin nhắn broadcast đến nhiều người dùng")}],B=async()=>{if(d.value)try{M.value=!0;const t={...m,hook_url:m.hook_url||o.value,redirect_url:m.redirect_url||a.value};z("submit",t)}catch(t){console.error("Error submitting form:",t)}finally{M.value=!1}},N=async()=>{try{R.value=!0;let t=await Z("mbw_transition_hub.api.external_connections.sync_accounts",{connection_id:f.existingConnection.connection_id,force_sync:!0});t&&t.status=="success"?(ce({title:__("Thành công"),text:__("Đồng bộ Zalo OA thành công"),icon:"check",iconClasses:"text-green-500"}),await le()):ce({title:__("Lỗi"),text:__("Đồng bộ Zalo OA thất bại"),icon:"x",iconClasses:"text-red-500"})}catch(t){console.error("Error syncing:",t),ce({title:__("Lỗi"),text:__("Đồng bộ Zalo OA thất bại"),icon:"x",iconClasses:"text-red-500"})}finally{R.value=!1}},ae=async()=>{try{T.value=!0,await ee(),ce({title:__("Thành công"),text:__("Làm mới templates thành công"),icon:"check",iconClasses:"text-green-500"})}catch(t){console.error("Error refreshing templates:",t),ce({title:__("Lỗi"),text:__("Làm mới templates thất bại"),icon:"x",iconClasses:"text-red-500"})}finally{T.value=!1}},le=async()=>{if(f.existingConnection)try{const t=await Z("mbw_transition_hub.api.external_connections.get_account_details",{connection_id:f.existingConnection.connection_id});q.value=t.oa_info||{},F.value=t.oa_stmira||{}}catch(t){console.error("Error loading OA info:",t)}},ee=async()=>{if(f.existingConnection)try{V.value=[{id:"template_1",name:__("Thông báo tuyển dụng"),content:__("Chúng tôi đang tuyển dụng vị trí {{job_title}}. Ứng tuyển ngay!"),status:"approved"},{id:"template_2",name:__("Lời chào ứng viên"),content:__("Xin chào! Cảm ơn bạn đã quan tâm đến vị trí {{job_title}}."),status:"pending"}]}catch(t){console.error("Error loading templates:",t)}},W=t=>[{label:__("Xem chi tiết"),icon:"eye",onClick:()=>Y()},{label:__("Sử dụng template"),icon:"copy",onClick:()=>H(t)}],Y=t=>{ce({title:__("Thông tin"),text:__("Chức năng xem template sẽ được triển khai"),icon:"info",iconClasses:"text-blue-500"})},H=t=>{ce({title:__("Thông tin"),text:`${__("Template ")}"${t.name}"${__(" đã được sao chép")}`,icon:"info",iconClasses:"text-blue-500"})},te=()=>{confirm(__("Bạn có chắc chắn muốn ngắt kết nối Zalo OA? Hành động này không thể hoàn tác."))&&z("submit",{action:"disconnect"})},J=t=>t?new Date(t).toLocaleString("vi-VN"):__("Chưa bao giờ");return ve(()=>{f.isEdit&&f.existingConnection?(Object.assign(m,{tenant_name:f.existingConnection.tenant_name||window.location.origin,user_email:f.existingConnection.user_email||"",full_name:f.existingConnection.full_name||"",hook_url:f.existingConnection.hook_url||o.value,redirect_url:f.existingConnection.redirect_url||a.value,sync_frequency:f.existingConnection.sync_frequency||"Hourly",daily_message_limit:f.existingConnection.daily_message_limit||1e3,max_retries:f.existingConnection.max_retries||3,debug_mode:f.existingConnection.debug_mode||!1,enable_broadcasting:f.existingConnection.enable_broadcasting!==!1,auto_sync_templates:f.existingConnection.auto_sync_templates!==!1}),le(),ee()):(m.hook_url=o.value,m.redirect_url=a.value),z("update:modelValue",{...m})}),_e(m,t=>{z("update:modelValue",{...t})},{deep:!0}),_e(()=>f.modelValue,t=>{t&&Object.keys(t).length>0&&Object.assign(m,t)},{deep:!0}),(t,g)=>{var se,ue,ie;return y(),v("div",Ht,[j.isEdit?(y(),v("div",Is,[e("div",Ms,[r(l(k),{name:"check-circle",class:"w-8 h-8 text-green-600 mr-3"}),e("div",Ls,[e("h4",Bs,s(t.__("Zalo OA đã kết nối")),1),e("p",Ns,s(t.__("OA:"))+" "+s(((se=j.existingConnection)==null?void 0:se.account_name)||t.__("Zalo Official Account")),1),e("p",Hs,s(t.__("ID:"))+" "+s(((ue=j.existingConnection)==null?void 0:ue.oa_id)||t.__("N/A")),1),e("p",Zs,s(t.__("Đồng bộ lần cuối:"))+" "+s(J((ie=j.existingConnection)==null?void 0:ie.last_sync)),1)]),r(l(O),{variant:"ghost",size:"sm",onClick:N,loading:R.value},{prefix:b(()=>[r(l(k),{name:"refresh-cw",class:"w-4 h-4"})]),default:b(()=>[x(" "+s(t.__("Đồng bộ")),1)]),_:1},8,["loading"])]),e("div",Gs,[e("h4",Ks,s(t.__("Thông tin Zalo OA")),1),e("div",Ws,[e("div",Ys,[e("div",Js,[e("div",Qs,[r(l(k),{name:"message-circle",class:"w-6 h-6 text-blue-600"})]),e("div",null,[e("h5",Xs,s(q.value.name||t.__("Zalo OA")),1),e("p",en,s(q.value.description||t.__("Official Account")),1)])]),e("div",tn,[e("div",sn,[e("span",nn,s(t.__("OA ID:")),1),e("span",on,s(q.value.oa_id||t.__("N/A")),1)]),e("div",an,[e("span",ln,s(t.__("Trạng thái:")),1),r(l(G),{variant:"solid",size:"sm"},{default:b(()=>[x(s(t.__("Hoạt động")),1)]),_:1})])])]),e("div",rn,[e("h5",cn,s(t.__("Thống kê")),1),e("div",dn,[e("div",un,[e("span",_n,s(t.__("Followers:")),1),e("span",mn,s(F.value.followers||t.__("N/A")),1)]),e("div",gn,[e("span",pn,s(t.__("Tin gửi hôm nay:")),1),e("span",yn,s(F.value.messages_today||"0"),1)]),e("div",fn,[e("span",bn,s(t.__("Template được duyệt:")),1),e("span",vn,s(F.value.approved_templates||"0"),1)])])])])]),e("div",hn,[e("div",kn,[e("h4",Cn,s(t.__("Message Templates")),1),r(l(O),{variant:"outline",size:"sm",onClick:ae,loading:T.value},{prefix:b(()=>[r(l(k),{name:"refresh-cw",class:"w-4 h-4"})]),default:b(()=>[x(" "+s(t.__("Làm mới")),1)]),_:1},8,["loading"])]),V.value.length>0?(y(),v("div",xn,[(y(!0),v(Q,null,X(V.value,C=>{var U;return y(),v("div",{key:C.id,class:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:border-gray-300 transition-colors"},[e("div",wn,[e("div",$n,[r(l(k),{name:"message-square",class:"w-4 h-4 text-green-600"})]),e("div",null,[e("div",Vn,s(C.name),1),e("div",An,s((U=C.content)==null?void 0:U.substring(0,50))+"...",1)])]),e("div",En,[r(l(G),{variant:C.status==="approved"?"solid":"outline",size:"sm"},{default:b(()=>[x(s(C.status==="approved"?t.__("Đã duyệt"):t.__("Chờ duyệt")),1)]),_:2},1032,["variant"]),r(l(Qe),{options:W(C)},{default:b(({open:he})=>[r(l(O),{variant:"ghost",size:"sm",onClick:he},{default:b(()=>[r(l(k),{name:"more-vertical",class:"w-4 h-4"})]),_:2},1032,["onClick"])]),_:2},1032,["options"])])])}),128))])):(y(),v("div",Sn,[r(l(k),{name:"message-square",class:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e("h3",Tn,s(t.__("Chưa có template")),1),e("p",On,s(t.__("Chưa có message template nào được tìm thấy.")),1),r(l(O),{variant:"outline",onClick:ae,loading:T.value},{prefix:b(()=>[r(l(k),{name:"refresh-cw",class:"w-4 h-4"})]),default:b(()=>[x(" "+s(t.__("Làm mới Templates")),1)]),_:1},8,["loading"])]))]),e("div",Un,[e("h4",jn,s(t.__("Cập nhật cài đặt")),1),e("div",Pn,[e("div",null,[e("label",Fn,s(t.__("Tần suất đồng bộ")),1),L(e("select",{"onUpdate:modelValue":g[8]||(g[8]=C=>m.sync_frequency=C),class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[e("option",qn,s(t.__("Every hour")),1),e("option",Dn,s(t.__("Every 5 minutes")),1),e("option",zn,s(t.__("Every 15 minutes")),1),e("option",Rn,s(t.__("Every 30 minutes")),1),e("option",In,s(t.__("Daily")),1),e("option",Mn,s(t.__("Real-time")),1)],512),[[we,m.sync_frequency]])]),e("div",null,[e("label",Ln,s(t.__("Giới hạn tin/ngày")),1),L(e("input",{"onUpdate:modelValue":g[9]||(g[9]=C=>m.daily_message_limit=C),type:"number",class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"1000"},null,512),[[ye,m.daily_message_limit]])])]),e("div",Bn,[e("div",Nn,[L(e("input",{id:"enable-broadcasting-edit","onUpdate:modelValue":g[10]||(g[10]=C=>m.enable_broadcasting=C),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[me,m.enable_broadcasting]]),e("label",Hn,s(t.__("Cho phép broadcast đến followers")),1)]),e("div",Zn,[L(e("input",{id:"auto-sync-templates","onUpdate:modelValue":g[11]||(g[11]=C=>m.auto_sync_templates=C),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[me,m.auto_sync_templates]]),e("label",Gn,s(t.__("Tự động đồng bộ templates")),1)]),e("div",Kn,[L(e("input",{id:"debug-mode-edit","onUpdate:modelValue":g[12]||(g[12]=C=>m.debug_mode=C),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[me,m.debug_mode]]),e("label",Wn,s(t.__("Bật chế độ debug")),1)])])]),e("div",Yn,[e("h4",Jn,s(t.__("Vùng nguy hiểm")),1),e("div",Qn,[e("div",Xn,[r(l(k),{name:"alert-triangle",class:"w-5 h-5 text-red-600 mr-3 mt-0.5"}),e("div",eo,[e("h5",to,s(t.__("Ngắt kết nối Zalo OA")),1),e("p",so,s(t.__("Hành động này sẽ xóa kết nối với Zalo OA và dừng tất cả hoạt động tự động.")),1),r(l(O),{variant:"ghost",class:"mt-3 text-red-600 hover:bg-red-100",onClick:te},{default:b(()=>[x(s(t.__("Ngắt kết nối Zalo OA")),1)]),_:1})])])])])])):(y(),v("div",Zt,[e("div",Gt,[r(l(k),{name:"message-circle",class:"w-8 h-8 text-blue-600 mr-3"}),e("div",null,[e("h4",Kt,s(t.__("Connect Zalo OA")),1),e("p",Wt,s(t.__("Kết nối Zalo Official Account để chia sẻ tin tuyển dụng")),1)])]),e("div",Yt,[e("h4",Jt,s(t.__("Thông tin cơ bản")),1),e("div",Qt,[e("div",null,[e("label",Xt,s(t.__("Email người dùng *")),1),L(e("input",{"onUpdate:modelValue":g[0]||(g[0]=C=>m.user_email=C),type:"email",class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:t.__("user@company.com"),required:""},null,8,es),[[ye,m.user_email]])]),e("div",null,[e("label",ts,s(t.__("Họ và tên *")),1),L(e("input",{"onUpdate:modelValue":g[1]||(g[1]=C=>m.full_name=C),type:"text",class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:t.__("Nhập họ và tên"),required:""},null,8,ss),[[ye,m.full_name]])])])]),e("div",ns,[e("h4",os,s(t.__("Cấu hình Webhook")),1),e("div",as,[e("div",ls,[r(l(k),{name:"alert-triangle",class:"w-4 h-4 text-yellow-600 mr-2 mt-0.5"}),e("div",is,[e("p",rs,s(t.__("Lưu ý quan trọng:")),1),e("p",null,s(t.__("Đảm bảo URL webhook có thể truy cập từ internet để SocialHub gửi callback.")),1)])])])]),e("div",cs,[e("h4",ds,s(t.__("Cài đặt Broadcasting")),1),e("div",us,[L(e("input",{id:"enable-broadcasting","onUpdate:modelValue":g[2]||(g[2]=C=>m.enable_broadcasting=C),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[me,m.enable_broadcasting]]),e("label",_s,s(t.__("Cho phép gửi tin broadcast đến followers")),1)]),e("div",ms,[e("div",null,[e("label",gs,s(t.__("Giới hạn tin/ngày")),1),L(e("input",{"onUpdate:modelValue":g[3]||(g[3]=C=>m.daily_message_limit=C),type:"number",class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"1000",min:"1"},null,512),[[ye,m.daily_message_limit]]),e("p",ps,s(t.__("Để trống nếu không giới hạn")),1)]),e("div",null,[e("label",ys,s(t.__("Ưu tiên tin nhắn")),1),L(e("select",{"onUpdate:modelValue":g[4]||(g[4]=C=>m.message_priority=C),class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[e("option",fs,s(t.__("Cao")),1),e("option",bs,s(t.__("Bình thường")),1),e("option",vs,s(t.__("Thấp")),1)],512),[[we,m.message_priority]])])])]),e("div",hs,[e("h4",ks,s(t.__("Cài đặt nâng cao")),1),e("div",Cs,[e("div",null,[e("label",xs,s(t.__("Tần suất đồng bộ")),1),L(e("select",{"onUpdate:modelValue":g[5]||(g[5]=C=>m.sync_frequency=C),class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[e("option",ws,s(t.__("Every hour")),1),e("option",$s,s(t.__("Every 5 minutes")),1),e("option",Vs,s(t.__("Every 15 minutes")),1),e("option",As,s(t.__("Every 30 minutes")),1),e("option",Es,s(t.__("Daily")),1),e("option",Ss,s(t.__("Real-time")),1)],512),[[we,m.sync_frequency]])]),e("div",null,[e("label",Ts,s(t.__("Số lần thử lại tối đa")),1),L(e("input",{"onUpdate:modelValue":g[6]||(g[6]=C=>m.max_retries=C),type:"number",min:"1",max:"5",class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"3"},null,512),[[ye,m.max_retries]])])]),e("div",Os,[L(e("input",{id:"debug-mode","onUpdate:modelValue":g[7]||(g[7]=C=>m.debug_mode=C),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[me,m.debug_mode]]),e("label",Us,s(t.__("Bật chế độ debug để ghi log chi tiết")),1)])]),e("div",js,[e("h4",Ps,s(t.__("Quyền truy cập Zalo")),1),e("div",Fs,[e("p",qs,s(t.__("Các quyền sau sẽ được yêu cầu khi xác thực Zalo OA:")),1),e("div",Ds,[(y(),v(Q,null,X(I,C=>e("div",{key:C.value,class:"flex items-start space-x-2"},[r(l(k),{name:"check",class:"w-4 h-4 text-green-600 mt-0.5"}),e("div",null,[e("div",zs,s(t.__(C.label)),1),e("div",Rs,s(t.__(C.description)),1)])])),64))])])])])),e("div",no,[r(l(O),{variant:"ghost",onClick:g[13]||(g[13]=C=>t.$emit("cancel"))},{default:b(()=>[x(s(t.__("Hủy")),1)]),_:1}),r(l(O),{variant:"solid",onClick:B,loading:M.value,disabled:!d.value},{default:b(()=>[x(s(j.isEdit?t.__("Cập nhật cài đặt"):t.__("Kết nối Zalo OA")),1)]),_:1},8,["loading","disabled"])])])}}},ao=be(oo,[["__scopeId","data-v-cd00d6b9"]]);const lo={class:"calcom-connection-form space-y-4"},io={class:"space-y-4"},ro={class:"font-medium text-gray-900 border-b pb-2"},co={class:"space-y-4"},uo={class:"font-medium text-gray-900 border-b pb-2"},_o={class:"space-y-4"},mo={class:"font-medium text-gray-900 border-b pb-2"},go={class:"space-y-4"},po={class:"font-medium text-gray-900 border-b pb-2"},yo={class:"bg-orange-50 rounded-lg p-3"},fo={class:"flex items-center gap-2 mb-2"},bo={class:"text-sm font-medium text-orange-900"},vo={class:"text-xs text-orange-700"},ho={key:0,class:"space-y-4"},ko={class:"font-medium text-gray-900 border-b pb-2"},Co={class:"space-y-4"},xo={class:"font-medium text-gray-900 border-b pb-2"},wo={class:"space-y-4"},$o={class:"font-medium text-gray-900 border-b pb-2"},Vo={class:"space-y-4"},Ao={class:"font-medium text-gray-900 border-b pb-2"},Eo={class:"space-y-4"},So={class:"font-medium text-gray-900 border-b pb-2"},To={class:"space-y-4"},Oo={class:"font-medium text-gray-900 border-b pb-2"},Uo={class:"grid grid-cols-1 gap-3"},jo=["id","value"],Po=["for"],Fo={class:"font-medium text-gray-900"},qo={class:"text-xs text-gray-500"},Do={__name:"CalcomConnectionForm",props:{modelValue:{type:Object,default:()=>({})},platform:{type:Object,required:!0},isEdit:{type:Boolean,default:!1},existingConnection:{type:Object,default:null}},emits:["update:modelValue"],setup(j,{emit:ne}){const f=j,z=ne,p=xe({tenant_name:"",user_email:"",full_name:"",calcom_username:"",api_key:"",instance_url:"https://cal.com",account_type:"personal",hook_url:"",redirect_url:"",webhook_secret:"",primary_calendar:"google",two_way_sync:!0,buffer_time:15,auto_sync_event_types:!0,default_duration:30,allow_cancellations:!0,email_notifications:!0,sms_notifications:!1,reminder_timing:"24h",custom_reminder:"",timezone:"Asia/Ho_Chi_Minh",booking_lead_time:24,max_bookings_per_day:10,auto_create_contacts:!0,contact_source:"booking",sync_booking_history:!1,sync_frequency:"hourly",max_retries:3,debug_mode:!1,permissions:["bookings","event_types","availability"]}),oe=[{label:__("Personal Account"),value:"personal"},{label:__("Team Account"),value:"team"},{label:__("Organization"),value:"organization"}],h=[{label:__("Google Calendar"),value:"google"},{label:__("Outlook Calendar"),value:"outlook"},{label:__("Apple Calendar"),value:"apple"},{label:__("CalDAV"),value:"caldav"}],M=[{label:__("15 minutes"),value:15},{label:__("30 minutes"),value:30},{label:__("45 minutes"),value:45},{label:__("1 hour"),value:60},{label:__("1.5 hours"),value:90},{label:__("2 hours"),value:120}],R=[{label:__("1 hour before"),value:"1h"},{label:__("24 hours before"),value:"24h"},{label:__("48 hours before"),value:"48h"},{label:__("1 week before"),value:"1w"}],T=[{label:__("Ho Chi Minh City (GMT+7)"),value:"Asia/Ho_Chi_Minh"},{label:__("Bangkok (GMT+7)"),value:"Asia/Bangkok"},{label:__("Singapore (GMT+8)"),value:"Asia/Singapore"},{label:__("Tokyo (GMT+9)"),value:"Asia/Tokyo"},{label:__("UTC"),value:"UTC"}],V=[{label:__("Calendar Booking"),value:"booking"},{label:__("Calendar Integration"),value:"calendar"},{label:__("Scheduling"),value:"scheduling"}],q=[{label:__("Every 5 minutes"),value:"5min"},{label:__("Every 15 minutes"),value:"15min"},{label:__("Every 30 minutes"),value:"30min"},{label:__("Every hour"),value:"hourly"},{label:__("Every 6 hours"),value:"6hourly"},{label:__("Daily"),value:"daily"}],F=[{label:__("Bookings"),value:"bookings",description:__("Access and manage bookings")},{label:__("Event Types"),value:"event_types",description:__("Access and manage event types")},{label:__("Availability"),value:"availability",description:__("Access availability information")},{label:__("Calendar Integration"),value:"calendar",description:__("Connect and sync with calendars")},{label:__("Webhooks"),value:"webhooks",description:__("Receive webhook notifications")},{label:__("User Profile"),value:"profile",description:__("Access user profile information")}];_e(p,o=>{z("update:modelValue",{...o})},{deep:!0}),_e(()=>f.modelValue,o=>{o&&Object.assign(p,o)},{deep:!0,immediate:!0}),ve(()=>{f.isEdit&&f.existingConnection&&Object.assign(p,{tenant_name:f.existingConnection.tenant_name||"",user_email:f.existingConnection.user_email||"",full_name:f.existingConnection.full_name||"",hook_url:f.existingConnection.hook_url||"",redirect_url:f.existingConnection.redirect_url||"",sync_frequency:f.existingConnection.sync_frequency||"hourly",max_retries:f.existingConnection.max_retries||3,...m(f.existingConnection.settings)})});function m(o){try{return typeof o=="string"?JSON.parse(o):o||{}}catch{return{}}}return(o,a)=>(y(),v("div",lo,[e("div",io,[e("h4",ro,s(o.__("Basic Information")),1),r(l(w),{label:o.__("User Email"),type:"email",modelValue:p.user_email,"onUpdate:modelValue":a[0]||(a[0]=d=>p.user_email=d),required:!0,readonly:j.isEdit,placeholder:o.__("user@company.com")},null,8,["label","modelValue","readonly","placeholder"]),r(l(w),{label:o.__("Full Name"),modelValue:p.full_name,"onUpdate:modelValue":a[1]||(a[1]=d=>p.full_name=d),required:!0,placeholder:o.__("Enter full name")},null,8,["label","modelValue","placeholder"])]),e("div",co,[e("h4",uo,s(o.__("Cal.com Configuration")),1),r(l(w),{label:o.__("Cal.com Username"),modelValue:p.calcom_username,"onUpdate:modelValue":a[2]||(a[2]=d=>p.calcom_username=d),required:!0,placeholder:o.__("your-username"),description:o.__("Your Cal.com username (e.g., john-doe)")},null,8,["label","modelValue","placeholder","description"]),r(l(w),{label:o.__("API Key"),type:"password",modelValue:p.api_key,"onUpdate:modelValue":a[3]||(a[3]=d=>p.api_key=d),required:!0,placeholder:o.__("Your Cal.com API Key"),description:o.__("Get this from Cal.com API settings")},null,8,["label","modelValue","placeholder","description"]),r(l(w),{label:o.__("Cal.com Instance URL"),modelValue:p.instance_url,"onUpdate:modelValue":a[4]||(a[4]=d=>p.instance_url=d),placeholder:o.__("https://cal.com"),description:o.__("Leave empty for default Cal.com, or enter your self-hosted URL")},null,8,["label","modelValue","placeholder","description"]),r(l(w),{type:"select",label:o.__("Account Type"),modelValue:p.account_type,"onUpdate:modelValue":a[5]||(a[5]=d=>p.account_type=d),options:oe,required:!0,description:o.__("Type of your Cal.com account")},null,8,["label","modelValue","description"])]),e("div",_o,[e("h4",mo,s(o.__("Webhook Configuration")),1),r(l(w),{label:o.__("Hook URL"),modelValue:p.hook_url,"onUpdate:modelValue":a[6]||(a[6]=d=>p.hook_url=d),required:!0,placeholder:o.__("https://your-domain.com/api/webhook/calcom"),description:o.__("URL to receive Cal.com webhooks")},null,8,["label","modelValue","placeholder","description"]),r(l(w),{label:o.__("Redirect URL"),modelValue:p.redirect_url,"onUpdate:modelValue":a[7]||(a[7]=d=>p.redirect_url=d),required:!0,placeholder:o.__("https://your-domain.com/auth/calcom/callback"),description:o.__("OAuth redirect URL after authentication")},null,8,["label","modelValue","placeholder","description"]),r(l(w),{label:o.__("Webhook Secret"),modelValue:p.webhook_secret,"onUpdate:modelValue":a[8]||(a[8]=d=>p.webhook_secret=d),placeholder:o.__("Auto-generated if empty"),description:o.__("Secret for webhook signature verification")},null,8,["label","modelValue","placeholder","description"])]),e("div",go,[e("h4",po,s(o.__("Calendar Integration")),1),e("div",yo,[e("div",fo,[r(l(k),{name:"calendar",class:"w-4 h-4 text-orange-600"}),e("span",bo,s(o.__("Calendar Sync")),1)]),e("div",vo,s(o.__("Configure how bookings sync with your calendar system")),1)]),r(l(w),{type:"select",label:o.__("Primary Calendar"),modelValue:p.primary_calendar,"onUpdate:modelValue":a[9]||(a[9]=d=>p.primary_calendar=d),options:h,description:o.__("Which calendar to use for bookings")},null,8,["label","modelValue","description"]),r(l(w),{type:"checkbox",label:o.__("Two-way sync"),modelValue:p.two_way_sync,"onUpdate:modelValue":a[10]||(a[10]=d=>p.two_way_sync=d),description:o.__("Sync events both from and to Cal.com")},null,8,["label","modelValue","description"]),r(l(w),{type:"number",label:o.__("Buffer Time (minutes)"),modelValue:p.buffer_time,"onUpdate:modelValue":a[11]||(a[11]=d=>p.buffer_time=d),placeholder:o.__("15"),description:o.__("Buffer time between bookings")},null,8,["label","modelValue","placeholder","description"])]),j.isEdit&&j.existingConnection?(y(),v("div",ho,[e("h4",ko,s(o.__("Event Types")),1),r(l(w),{type:"checkbox",label:o.__("Auto-sync event types"),modelValue:p.auto_sync_event_types,"onUpdate:modelValue":a[12]||(a[12]=d=>p.auto_sync_event_types=d),description:o.__("Automatically sync new event types from Cal.com")},null,8,["label","modelValue","description"]),r(l(w),{type:"select",label:o.__("Default Event Duration"),modelValue:p.default_duration,"onUpdate:modelValue":a[13]||(a[13]=d=>p.default_duration=d),options:M,description:o.__("Default duration for new event types")},null,8,["label","modelValue","description"]),r(l(w),{type:"checkbox",label:o.__("Allow cancellations"),modelValue:p.allow_cancellations,"onUpdate:modelValue":a[14]||(a[14]=d=>p.allow_cancellations=d),description:o.__("Allow attendees to cancel bookings")},null,8,["label","modelValue","description"])])):$("",!0),e("div",Co,[e("h4",xo,s(o.__("Notification Settings")),1),r(l(w),{type:"checkbox",label:o.__("Email notifications"),modelValue:p.email_notifications,"onUpdate:modelValue":a[15]||(a[15]=d=>p.email_notifications=d),description:o.__("Send email notifications for bookings")},null,8,["label","modelValue","description"]),r(l(w),{type:"checkbox",label:o.__("SMS notifications"),modelValue:p.sms_notifications,"onUpdate:modelValue":a[16]||(a[16]=d=>p.sms_notifications=d),description:o.__("Send SMS notifications for bookings")},null,8,["label","modelValue","description"]),r(l(w),{type:"select",label:o.__("Reminder timing"),modelValue:p.reminder_timing,"onUpdate:modelValue":a[17]||(a[17]=d=>p.reminder_timing=d),options:R,description:o.__("When to send booking reminders")},null,8,["label","modelValue","description"]),r(l(w),{label:o.__("Custom reminder message"),type:"textarea",modelValue:p.custom_reminder,"onUpdate:modelValue":a[18]||(a[18]=d=>p.custom_reminder=d),placeholder:o.__("Don't forget about your upcoming appointment..."),description:o.__("Custom message for booking reminders")},null,8,["label","modelValue","placeholder","description"])]),e("div",wo,[e("h4",$o,s(o.__("Availability Settings")),1),r(l(w),{type:"select",label:o.__("Timezone"),modelValue:p.timezone,"onUpdate:modelValue":a[19]||(a[19]=d=>p.timezone=d),options:T,description:o.__("Default timezone for bookings")},null,8,["label","modelValue","description"]),r(l(w),{type:"number",label:o.__("Booking lead time (hours)"),modelValue:p.booking_lead_time,"onUpdate:modelValue":a[20]||(a[20]=d=>p.booking_lead_time=d),placeholder:o.__("24"),description:o.__("Minimum hours in advance for bookings")},null,8,["label","modelValue","placeholder","description"]),r(l(w),{type:"number",label:o.__("Max bookings per day"),modelValue:p.max_bookings_per_day,"onUpdate:modelValue":a[21]||(a[21]=d=>p.max_bookings_per_day=d),placeholder:o.__("10"),description:o.__("Maximum number of bookings per day")},null,8,["label","modelValue","placeholder","description"])]),e("div",Vo,[e("h4",Ao,s(o.__("Integration Settings")),1),r(l(w),{type:"checkbox",label:o.__("Create contacts automatically"),modelValue:p.auto_create_contacts,"onUpdate:modelValue":a[22]||(a[22]=d=>p.auto_create_contacts=d),description:o.__("Automatically create contacts for new bookings")},null,8,["label","modelValue","description"]),r(l(w),{type:"select",label:o.__("Contact source"),modelValue:p.contact_source,"onUpdate:modelValue":a[23]||(a[23]=d=>p.contact_source=d),options:V,description:o.__("How to categorize contacts from bookings")},null,8,["label","modelValue","description"]),r(l(w),{type:"checkbox",label:o.__("Sync booking history"),modelValue:p.sync_booking_history,"onUpdate:modelValue":a[24]||(a[24]=d=>p.sync_booking_history=d),description:o.__("Import existing booking history")},null,8,["label","modelValue","description"])]),e("div",Eo,[e("h4",So,s(o.__("Advanced Settings")),1),r(l(w),{type:"select",label:o.__("Sync Frequency"),modelValue:p.sync_frequency,"onUpdate:modelValue":a[25]||(a[25]=d=>p.sync_frequency=d),options:q,description:o.__("How often to sync data from Cal.com")},null,8,["label","modelValue","description"]),r(l(w),{type:"number",label:o.__("Max Retries"),modelValue:p.max_retries,"onUpdate:modelValue":a[26]||(a[26]=d=>p.max_retries=d),placeholder:o.__("3"),description:o.__("Maximum number of retry attempts for failed requests")},null,8,["label","modelValue","placeholder","description"]),r(l(w),{type:"checkbox",label:o.__("Enable Debug Mode"),modelValue:p.debug_mode,"onUpdate:modelValue":a[27]||(a[27]=d=>p.debug_mode=d),description:o.__("Enable detailed logging for troubleshooting")},null,8,["label","modelValue","description"])]),e("div",To,[e("h4",Oo,s(o.__("Required Permissions")),1),e("div",Uo,[(y(),v(Q,null,X(F,d=>e("div",{key:d.value,class:"flex items-start gap-2"},[L(e("input",{type:"checkbox",id:d.value,"onUpdate:modelValue":a[28]||(a[28]=I=>p.permissions=I),value:d.value,class:"mt-1"},null,8,jo),[[me,p.permissions]]),e("label",{for:d.value,class:"text-sm"},[e("div",Fo,s(o.__(d.label)),1),e("div",qo,s(o.__(d.description)),1)],8,Po)])),64))])])]))}},zo=be(Do,[["__scopeId","data-v-3a9f9cc0"]]);const Ro={class:"topcv-connection-form"},Io={key:0,class:"space-y-4 mb-6"},Mo={class:"font-medium text-gray-900 border-b pb-2"},Lo={class:"bg-green-50 rounded-lg p-4"},Bo={class:"flex items-center gap-2 mb-3"},No={class:"font-medium text-green-800"},Ho={class:"space-y-2"},Zo={class:"flex items-center gap-3"},Go={class:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center"},Ko={class:"font-medium text-gray-900"},Wo={class:"text-xs text-gray-500"},Yo={class:"flex items-center gap-2"},Jo={class:"space-y-6"},Qo={class:"space-y-4"},Xo={class:"flex items-center justify-between border-b pb-2"},ea={class:"font-medium text-gray-900"},ta={key:0,class:"bg-gray-50 rounded-lg p-4 space-y-3"},sa={class:"font-medium text-gray-800"},na={class:"text-sm text-gray-700 space-y-2 list-decimal list-inside"},oa={class:"text-xs text-gray-600 bg-white p-2 rounded border"},aa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},la={class:"bg-blue-50 rounded-lg p-4"},ia={class:"flex items-start gap-3"},ra={class:"font-medium text-blue-900"},ca={class:"text-sm text-blue-700 mt-1"},da={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},ua={class:"flex items-center justify-between"},_a={class:"font-medium text-gray-900"},ma={class:"text-sm text-gray-600"},ga={class:"flex items-center gap-2"},pa={class:"flex justify-between items-center pt-6 border-t"},ya={class:"flex gap-3"},fa={__name:"TopcvConnectionForm",props:{modelValue:{type:Object,default:()=>({})},platform:{type:Object,required:!0},isEdit:{type:Boolean,default:!1},existingConnection:{type:Object,default:()=>({})},connectedAccounts:{type:Array,default:()=>[]}},emits:["update:modelValue","submit","cancel"],setup(j,{emit:ne}){var te,J;const f=j,z=ne,{userResource:p,allUsers:oe,getUser:h}=Ve(),M=S(!1),R=S(!1),T=S(!1);S(!1);const V=ge(null),q=S({}),F={user_email:(te=h==null?void 0:h.data)==null?void 0:te.email,full_name:(J=h==null?void 0:h.data)==null?void 0:J.full_name,tenant_name:"",api_key:"",client_secret:"",hook_url:"",redirect_url:"",timeout:30,max_retries:3,permissions:["job_posting","application_management","candidate_search"],auto_post_jobs:!0,auto_import_applications:!0,sync_candidate_profiles:!0,job_duration:30,sync_frequency:"Hourly",enable_resume_search:!1,debug_mode:!1,daily_search_limit:100},m=S({...F});__("Every 5 minutes"),__("Every 15 minutes"),__("Every 30 minutes"),__("Every hour"),__("Real-time"),__("Daily");const o=K(()=>m.value.hook_url||""),a=K(()=>m.value.redirect_url||""),d=K(()=>{var A,t;const _=m.value;return console.log(_),!!((A=_.api_key)!=null&&A.trim()&&((t=_.client_secret)!=null&&t.trim())&&Object.keys(q.value).length===0)}),I=K(()=>B.value.length>0),B=K(()=>{var _;return f.connectedAccounts.length>0?f.connectedAccounts:((_=f.existingConnection)==null?void 0:_.accounts)||[]}),N=()=>{var t,g;const _={},A=m.value;return(t=A.api_key)!=null&&t.trim()||(_.api_key=__("API Key is required")),(g=A.client_secret)!=null&&g.trim()||(_.client_secret=__("Secret Key is required")),q.value=_,Object.keys(_).length===0},ae=async()=>{if(!d.value){ce({title:__("Validation Error"),text:__("Please fix form errors before testing"),icon:"x",iconClasses:"text-red-600"});return}R.value=!0,V.value=null;try{const _=await Z("mbw_transition_hub.api.external_connections.test_connection",{tenant_name:m.value.tenant_name,connection_id:f.existingConnection.connection_id});(_==null?void 0:_.status)==="Success"?V.value={success:!0,message:__("Connection test successful! TopCV API is configured properly.")}:V.value={success:!1,message:(_==null?void 0:_.message)||__("Connection test failed")}}catch(_){console.error("Connection test error:",_),V.value={success:!1,message:_.message||__("Failed to test connection")}}finally{R.value=!1}},le=async()=>{if(!N()){ce({title:__("Validation Error"),text:__("Please fix the errors in the form"),icon:"x",iconClasses:"text-red-600"});return}M.value=!0;const _={tenant_name:m.value.tenant_name.trim(),api_key:m.value.api_key.trim(),secret_key:m.value.client_secret.trim(),hook_url:m.value.hook_url.trim(),user_email:m.value.user_email,full_name:m.value.full_name};console.log(_),z("submit",_)},ee=()=>{f.isEdit&&f.existingConnection?Y():Object.assign(m.value,{...F}),q.value={},V.value=null,z("cancel")},W=()=>{fe(()=>{z("update:modelValue",{...m.value})})},Y=()=>{if(f.existingConnection){const _=f.existingConnection;Object.assign(m.value,{tenant_name:_.tenant_name||"",api_key:_.api_key||"",client_secret:_.secret_key||"",hook_url:_.hook_url||"",redirect_url:_.redirect_url||a.value,timeout:_.timeout||30,max_retries:_.max_retries||3,permissions:_.permissions||[...F.permissions],auto_post_jobs:_.auto_post_jobs??!0,auto_import_applications:_.auto_import_applications??!0,sync_candidate_profiles:_.sync_candidate_profiles??!0,job_duration:_.job_duration||30,sync_frequency:_.sync_frequency||"Hourly",enable_resume_search:_.enable_resume_search||!1,debug_mode:_.debug_mode||!1,daily_search_limit:_.daily_search_limit||100})}};let H=null;return _e(m,()=>{H&&clearTimeout(H),H=setTimeout(()=>{N(),W()},300)},{deep:!0,flush:"post"}),_e(()=>f.modelValue,_=>{if(_&&typeof _=="object"){const A=JSON.stringify(m.value),t=JSON.stringify({...F,..._});A!==t&&Object.assign(m.value,{...F,..._})}},{immediate:!1,deep:!0}),ve(()=>{f.isEdit&&f.existingConnection?Y():f.modelValue&&Object.keys(f.modelValue).length>0&&Object.assign(m.value,{...F,...f.modelValue}),m.value.redirect_url||(m.value.redirect_url=a.value),m.value.hook_url||(m.value.hook_url=o.value),fe(()=>{N(),W()})}),(_,A)=>(y(),v("div",Ro,[j.isEdit&&I.value?(y(),v("div",Io,[e("h4",Mo,s(_.__("Connected Accounts")),1),e("div",Lo,[e("div",Bo,[r(l(k),{name:"check-circle",class:"w-5 h-5 text-green-600"}),e("h5",No,s(_.__("Active TopCV Accounts")),1)]),e("div",Ho,[(y(!0),v(Q,null,X(B.value,t=>(y(),v("div",{key:t.external_account_id,class:"flex items-center justify-between p-3 bg-white rounded border"},[e("div",Zo,[e("div",Go,[r(l(k),{name:"briefcase",class:"w-4 h-4 text-purple-600"})]),e("div",null,[e("div",Ko,s(t.account_name),1),e("div",Wo,s(t.account_type)+" • ID: "+s(t.external_account_id),1)])]),e("div",Yo,[t.is_primary?(y(),D(l(G),{key:0,variant:"success",size:"sm"},{default:b(()=>[x(s(_.__("Primary")),1)]),_:1})):$("",!0),r(l(G),{variant:t.is_active?"success":"gray",size:"sm"},{default:b(()=>[x(s(t.is_active?_.__("Active"):_.__("Inactive")),1)]),_:2},1032,["variant"])])]))),128))])])])):$("",!0),e("div",Jo,[e("div",Qo,[e("div",Xo,[e("h4",ea,s(_.__("TopCV API Configuration")),1),r(l(O),{onClick:A[0]||(A[0]=t=>T.value=!T.value),variant:"ghost",size:"sm"},{prefix:b(()=>[r(l(k),{name:"help-circle",class:"w-4 h-4"})]),default:b(()=>[x(" "+s(_.__("Setup Guide")),1)]),_:1})]),T.value?(y(),v("div",ta,[e("h5",sa,s(_.__("TopCV API Setup Instructions:")),1),e("ol",na,[e("li",null,s(_.__("Login to your TopCV employer account")),1),e("li",null,s(_.__('Navigate to "API Settings" or "Developer Settings" section')),1),e("li",null,s(_.__("Generate or retrieve your API Key and Secret Key")),1),e("li",null,s(_.__("Copy the credentials and paste them in the form below")),1),e("li",null,s(_.__("Configure webhook URL for receiving notifications")),1)]),e("div",oa,[e("strong",null,s(_.__("Webhook URL:")),1),x(" "+s(o.value),1)])])):$("",!0),e("div",aa,[r(l(w),{label:_.__("API Key"),type:"password",modelValue:m.value.api_key,"onUpdate:modelValue":A[1]||(A[1]=t=>m.value.api_key=t),placeholder:_.__("Enter your TopCV API Key"),required:!0,error:q.value.api_key,description:_.__("Get this from TopCV API settings")},null,8,["label","modelValue","placeholder","error","description"]),r(l(w),{label:_.__("Secret Key"),type:"password",modelValue:m.value.client_secret,"onUpdate:modelValue":A[2]||(A[2]=t=>m.value.client_secret=t),placeholder:_.__("Enter your TopCV Secret Key"),required:!0,error:q.value.client_secret,description:_.__("Keep this secure - never share publicly")},null,8,["label","modelValue","placeholder","error","description"])]),e("div",la,[e("div",ia,[r(l(k),{name:"shield-check",class:"w-5 h-5 text-blue-600 mt-0.5"}),e("div",null,[e("h5",ra,s(_.__("Secure API Connection")),1),e("p",ca,s(_.__("Your API credentials are encrypted and stored securely. They are used only for authorized TopCV operations.")),1)])])])]),j.isEdit?(y(),v("div",da,[e("div",ua,[e("div",null,[e("h5",_a,s(_.__("Test Connection")),1),e("p",ma,s(_.__("Verify that your TopCV connection is working")),1)]),r(l(O),{onClick:ae,variant:"outline",size:"sm",loading:R.value},{prefix:b(()=>[r(l(k),{name:"zap",class:"w-4 h-4"})]),default:b(()=>[x(" "+s(_.__("Test")),1)]),_:1},8,["loading"])]),V.value?(y(),v("div",{key:0,class:de(["mt-3 p-3 rounded border",V.value.success?"border-green-200 bg-green-50":"border-red-200 bg-red-50"])},[e("div",ga,[r(l(k),{name:V.value.success?"check-circle":"x-circle",class:de(["w-4 h-4",V.value.success?"text-green-600":"text-red-600"])},null,8,["name","class"]),e("span",{class:de(["text-sm font-medium",V.value.success?"text-green-800":"text-red-800"])},s(V.value.message),3)])],2)):$("",!0)])):$("",!0)]),e("div",pa,[e("div",ya,[r(l(O),{onClick:ee,variant:"ghost"},{default:b(()=>[x(s(_.__("Cancel")),1)]),_:1}),r(l(O),{onClick:le,variant:"solid",loading:M.value,disabled:!d.value},{default:b(()=>[x(s(j.isEdit?_.__("Update Connection"):_.__("Connect TopCV")),1)]),_:1},8,["loading","disabled"])])])]))}},ba=be(fa,[["__scopeId","data-v-2291143c"]]);const va={class:"external-connections-container"},ha={class:"flex items-center justify-between mb-6"},ka={class:"text-2xl font-bold text-gray-900"},Ca={class:"text-sm text-gray-600 mt-1"},xa={class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-2 gap-6"},wa={class:"p-4 border-b border-gray-100"},$a={class:"flex items-center gap-3"},Va={class:"font-semibold text-gray-900"},Aa={class:"text-xs text-gray-500"},Ea={class:"p-4 space-y-3"},Sa={class:"flex items-center justify-between mb-2"},Ta={class:"flex items-center gap-3"},Oa={class:"text-lg"},Ua={class:"font-medium text-gray-900"},ja={class:"text-xs text-gray-500"},Pa={key:0,class:"mb-3"},Fa={class:"text-xs text-gray-600 mb-1"},qa={class:"space-y-1"},Da={class:"w-4 h-4 rounded-full bg-green-100 flex items-center justify-center"},za={class:"text-gray-700"},Ra={class:"mb-3"},Ia={class:"flex flex-wrap gap-1"},Ma={class:"flex items-center gap-2"},La={key:0,class:"space-y-4 p-4"},Ba={class:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg"},Na={class:"text-2xl"},Ha={class:"font-semibold text-gray-900"},Za={class:"text-sm text-gray-600"},Ga={key:0,class:"space-y-4"},Ka={class:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg"},Wa={class:"text-2xl"},Ya={class:"font-semibold text-gray-900"},Ja={class:"text-sm text-gray-600"},Qa={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-3"},Xa={class:"flex items-center gap-2"},el={class:"text-sm text-yellow-800"},tl={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-3"},sl={class:"flex items-center gap-2"},nl={class:"text-sm text-red-800"},ol={key:2,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},al={class:"flex items-center gap-2"},ll={class:"text-sm text-gray-800"},il={key:3,class:"bg-blue-50 rounded-lg p-4"},rl={class:"font-medium text-gray-900 mb-3 flex items-center gap-2"},cl={class:"space-y-2"},dl={class:"flex items-center gap-2"},ul={class:"w-6 h-6 rounded-full bg-green-100 flex items-center justify-center"},_l={class:"text-sm font-medium text-gray-900"},ml={class:"text-xs text-gray-500"},gl={class:"flex items-center gap-1"},pl={key:4,class:"bg-yellow-50 rounded-lg p-4"},yl={class:"flex items-center gap-2"},fl={class:"text-sm text-yellow-800"},bl={key:0,class:"space-y-6"},vl={class:"bg-gray-50 rounded-lg p-4"},hl={class:"font-semibold text-gray-900 mb-2"},kl={class:"grid grid-cols-2 gap-4 text-sm"},Cl={class:"text-gray-600"},xl={class:"ml-2 font-medium"},wl={class:"text-gray-600"},$l={class:"text-gray-600"},Vl={class:"ml-2"},Al={class:"text-gray-600"},El={class:"ml-2"},Sl={key:0},Tl={class:"font-semibold text-gray-900 mb-3"},Ol={class:"space-y-2"},Ul={class:"flex items-center gap-3"},jl={class:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center"},Pl={class:"font-medium text-gray-900"},Fl={class:"text-xs text-gray-500"},ql={class:"flex items-center gap-2"},Dl={key:1,class:"text-center py-6"},zl={class:"text-gray-500"},Rl={key:2},Il={class:"font-semibold text-gray-900 mb-3"},Ml={class:"grid grid-cols-3 gap-4"},Ll={class:"text-center p-3 bg-blue-50 rounded-lg"},Bl={class:"text-2xl font-bold text-blue-600"},Nl={class:"text-xs text-blue-600"},Hl={class:"text-center p-3 bg-green-50 rounded-lg"},Zl={class:"text-2xl font-bold text-green-600"},Gl={class:"text-xs text-green-600"},Kl={class:"text-center p-3 bg-red-50 rounded-lg"},Wl={class:"text-2xl font-bold text-red-600"},Yl={class:"text-xs text-red-600"},Jl={class:"mt-3 p-3 bg-gray-50 rounded-lg"},Ql={class:"flex items-center justify-between text-sm"},Xl={class:"text-gray-600"},ei={class:"flex items-center gap-2"},ti={__name:"APIIntegrationList",emits:["connection-updated","job-shared"],setup(j,{emit:ne}){const{success:f,error:z,warning:p,info:oe}=Fe(),h=(n,i,c)=>n==="success"?f(`${i}: ${c}`):n==="error"?z(`${i}: ${c}`):n==="warning"?p(`${i}: ${c}`):oe(`${i}: ${c}`),M={social_media:{title:__("Social Media"),icon:"users",color:"bg-blue-500",platforms:[{id:"facebook",name:"Facebook",icon:"📘",description:__("Connect Facebook Pages and Personal Profiles"),color:"border-blue-500",features:[__("Pages Management"),__("Posts Publishing"),__("Comments Monitoring"),__("Insights Analytics")]}]},messaging:{title:__("Messaging Platforms"),icon:"message-circle",color:"bg-green-500",platforms:[{id:"zalo",name:"Zalo",icon:"💬",description:__("Connect Zalo Official Accounts"),color:"border-blue-400",features:[__("Message Broadcasting"),__("Customer Chat"),__("Template Messages"),__("User Management")]}]},calendar:{title:__("Calendar Integration"),icon:"calendar",color:"bg-orange-500",platforms:[{id:"cal_com",name:"Cal.com",icon:"📅",description:__("Connect Cal.com Scheduling"),color:"border-orange-500",features:[__("Event Scheduling"),__("Calendar Sync"),__("Booking Management"),__("Availability Settings")]}]},job_board:{title:__("Job Board"),icon:"briefcase",color:"bg-purple-500",platforms:[{id:"topcv",name:"TopCV",icon:"💼",description:__("Connect TopCV Job Portal"),color:"border-purple-500",features:[__("Job Posting"),__("Candidate Management"),__("Application Tracking"),__("Resume Database Access")]}]}},R=ge({facebook:Pe,zalo:ao,cal_com:zo,topcv:ba}),T=S([]),V=S(!1),q=S(!1),F=S(!1),m=S(!1),o=ge(null),a=ge(null),d=ge(null),I=S([]),B=S([]),N=S([]),ae=S(!1),le=S(!1),ee=S(!1),W=xe({tenant_name:"",hook_url:"",redirect_url:""}),Y=xe({tenant_name:"",hook_url:"",redirect_url:""}),H=ne,te=K(()=>{var n;return(n=o.value)!=null&&n.id?R.value[o.value.id]||Pe:null}),J=K({get(){return{...W}},set(n){Object.assign(W,n)}}),_=K({get(){return{...Y}},set(n){Object.assign(Y,n)}}),A=n=>Array.isArray(T.value)?T.value.find(i=>i.platform_type.toLowerCase()===n):null,t=n=>{const i=A(n);return(i==null?void 0:i.connection_status)||null},g=n=>A(n),se=n=>t(n)==="Connected",ue=n=>{const i=t(n);return i==="Failed"||i==="Disconnected"},ie=n=>t(n)!==null,C=n=>{const i=A(n);return!i||i.connection_status!=="Connected"?[]:(i==null?void 0:i.accounts)||(i==null?void 0:i.connected_accounts)||[]},U=n=>{switch(t(n)){case"Connected":return"success";case"Pending":return"warning";case"Failed":case"Disconnected":return"red";default:return"subtle"}},he=n=>{const i=t(n);return i?__(i):__("Not Connected")},qe=n=>{switch(n){case"Connected":return"success";case"Pending":return"warning";case"Failed":case"Disconnected":return"red";default:return"gray"}},Ae=n=>{if(!o.value)return __("Platform Connection");if(n==="connect")return`${__("Connect to")} ${o.value.name}`;if(n==="edit"){const i=t(o.value.id);return`${__("Edit")} ${o.value.name} ${__("Connection")}${i?` (${__(i)})`:""}`}return __("Platform Connection")},ke=n=>{Object.keys(n).forEach(i=>{n[i]=""})},Ce=(n,i)=>{const c=i.findIndex(u=>u===n);c>-1&&i.splice(c,1)},Ee=n=>{const c=[].filter(u=>{var E;return!((E=n[u])!=null&&E.trim())});if(c.length>0)throw new Error(`${__("Missing required fields:")} ${c.join(", ")}`);return!0},pe=(n,i=__("Operation completed successfully"))=>{var c;if((c=n==null?void 0:n.data)!=null&&c.login_url){const u=window.open(n.data.login_url,"_blank");return!u||u.closed||typeof u.closed>"u"?h("warning",__("Popup Blocked"),__("Please allow popups to complete authentication.")):h("info",__("Authentication"),__("Please complete authentication in the new window.")),{success:!0,message:__("Please complete authentication in the new window."),requiresAuth:!0}}else{if((n==null?void 0:n.status)==="success")return{success:!0,message:i,requiresAuth:!1};throw new Error((n==null?void 0:n.message)||__("Operation failed"))}},Se=n=>{const i=n.total_api_calls||0,c=n.successful_calls||0;return i===0?0:Math.round(c/i*100)},De=n=>{const i=Se(n);return i>=95?"text-green-600":i>=80?"text-yellow-600":"text-red-600"},Te=n=>{if(!n)return __("N/A");try{return new Date(n).toLocaleDateString("vi-VN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return __("Invalid Date")}},Oe=()=>{q.value=!1,o.value=null,ke(W)},Ue=()=>{m.value=!1,d.value=null,o.value=null,ke(Y)},ze=()=>{F.value=!1,a.value=null},Re=n=>{o.value={...n},ke(W),q.value=!0},Ie=async n=>{var c;const i=A(n);if(!i){h("error",__("Error"),__("Connection not found"));return}try{let u=[];if(i.connection_status==="Connected")try{const P=await Z("mbw_transition_hub.api.external_connections.get_account_details",{connection_id:i.connection_id||i.name});((c=P==null?void 0:P.message)==null?void 0:c.status)==="success"?u=P.message.data||[]:(P==null?void 0:P.status)==="success"?u=P.data||[]:Array.isArray(P)?u=P:P!=null&&P.message&&(u=Array.isArray(P.message)?P.message:[])}catch(P){console.warn(__("Failed to load account details, proceeding without accounts:"),P)}const E={...i,accounts:u,connected_accounts:u};d.value=E,o.value=Object.values(M).flatMap(P=>P.platforms).find(P=>P.id===n),ke(Y),Object.assign(Y,{tenant_name:E.tenant_name||"",hook_url:E.hook_url||"",redirect_url:E.redirect_url||""}),m.value=!0}catch(u){console.error("Error loading connection for edit:",u),h("error",__("Error"),__("Failed to load connection details for editing"))}},Me=async n=>{var c;const i=A(n);if(i){if(i.connection_status!=="Connected"){h("warning",__("Cannot Access Settings"),__("Account settings are only available for connected platforms"));return}try{const u=await Z("mbw_transition_hub.api.external_connections.get_account_details",{connection_id:i.connection_id||i.name});let E=[];((c=u==null?void 0:u.message)==null?void 0:c.status)==="success"?E=u.message.data||[]:(u==null?void 0:u.status)==="success"?E=u.data||[]:Array.isArray(u)?E=u:u!=null&&u.message&&(E=Array.isArray(u.message)?u.message:[]),a.value={...i,accounts:E},F.value=!0}catch(u){console.error("Error loading account details:",u),h("error",__("Error"),__("Failed to load account details"))}}},Le=async n=>{try{Ee(n);const i=await Z("mbw_transition_hub.api.external_connections.create_connection",{platform_type:o.value.name,hook_url:n.hook_url,redirect_url:n.redirect_url,user_email:n.user_email,full_name:n.full_name}),c=pe(i,__("Connection created successfully"));return h("success",__("Success"),c.message),await re(),H("connection-updated",{action:"create",platform:o.value.name,requiresAuth:c.requiresAuth}),c}catch(i){throw console.error("Error creating connection:",i),h("error",__("Error"),i.message||__("Failed to create connection")),i}},Be=async n=>{var i;try{Ee(n);const c=await Z("mbw_transition_hub.api.external_connections.update_connection",{connection_id:d.value.connection_id||d.value.name,tenant_name:n.tenant_name,hook_url:n.hook_url,redirect_url:n.redirect_url,user_email:n.user_email,full_name:n.full_name}),u=pe(c,__("Connection updated successfully"));return h("success",__("Success"),u.message),await re(),H("connection-updated",{action:"update",platform:(i=o.value)==null?void 0:i.name,requiresAuth:u.requiresAuth}),u}catch(c){throw console.error("Error updating connection:",c),h("error",__("Error"),c.message||__("Failed to update connection")),c}},Ne=async n=>{var u;if(!A(n))return;const c=((u=Object.values(M).flatMap(E=>E.platforms).find(E=>E.id===n))==null?void 0:u.name)||__("Platform");confirm(`${__("Are you sure you want to disconnect from")} ${c}? ${__("This action cannot be undone.")}`)&&await Ke(n)},He=async n=>{var i;if(n){ee.value=!0;try{const c=await Z("mbw_transition_hub.api.external_connections.get_account_details",{connection_id:n.connection_id||n.name,force_refresh:!0});let u=[];((i=c==null?void 0:c.message)==null?void 0:i.status)==="success"?u=c.message.data||[]:(c==null?void 0:c.status)==="success"?u=c.data||[]:Array.isArray(c)&&(u=c),a.value={...a.value,accounts:u,last_sync_time:new Date().toISOString()},h("success",__("Success"),__("Connection refreshed successfully")),await re()}catch(c){console.error("Error refreshing single connection:",c),h("error",__("Error"),c.message||__("Failed to refresh connection"))}finally{ee.value=!1}}},re=async()=>{V.value=!0;try{const n={tenant_name:W.tenant_name||""},i=await Z("mbw_transition_hub.api.external_connections.get_connection_info",n);let c=[];i&&i.status==="success"&&i.data?c=Array.isArray(i.data)?i.data:[]:i&&i.message?c=Array.isArray(i.message)?i.message:[]:Array.isArray(i)?c=i:(console.warn(__("Unexpected response format:"),i),c=[]),await fe(),T.value=c}catch(n){console.error("Error refreshing connections:",n),T.value=[],h("error",__("Error"),`${__("Failed to refresh connections:")} ${n.message||n}`)}finally{V.value=!1}},Ze=async n=>{var i;if(o.value){ae.value=!0,I.value.push(o.value.id);try{await Le(n),Oe()}catch{}finally{ae.value=!1,Ce((i=o.value)==null?void 0:i.id,I.value)}}},Ge=async n=>{if(d.value){le.value=!0;try{await Be(n),Ue()}catch{}finally{le.value=!1}}},Ke=async n=>{const i=A(n);if(!i){h("error",__("Error"),__("Connection not found"));return}if(!ie(n)){h("warning",__("Cannot Disconnect"),__("This connection cannot be disconnected in its current state"));return}B.value.push(n);try{const c=await Z("mbw_transition_hub.api.external_connections.disconnect_connection",{connection_id:i.connection_id,reason:__("User requested disconnect")}),u=pe(c,__("Platform disconnected successfully"));h("success",__("Success"),u.message),await re(),H("connection-updated",{action:"disconnect",platform:i.platform_type})}catch(c){console.error("Error disconnecting platform:",c),h("error",__("Error"),c.message||__("Failed to disconnect platform"))}finally{Ce(n,B.value)}},We=async n=>{const i=A(n);if(!i){h("error",__("Error"),__("Connection not found"));return}if(i.connection_status!=="Connected"){h("warning",__("Cannot Sync"),__("Account sync is only available for connected platforms"));return}N.value.push(n);try{const c=await Z("mbw_transition_hub.api.external_connections.sync_accounts",{connection_id:i.connection_id,force_sync:!0}),u=pe(c,__("Accounts synced successfully"));h("success",__("Success"),u.message),await re()}catch(c){console.error("Error syncing accounts:",c),h("error",__("Error"),c.message||__("Failed to sync accounts"))}finally{Ce(n,N.value)}},Ye=async n=>{const i=A(n);if(!i){h("error",__("Error"),__("Connection not found"));return}if(!ue(n)){h("warning",__("Cannot Retry"),__("Connection retry is only available for failed connections"));return}I.value.push(n);try{const c=await Z("mbw_transition_hub.api.external_connections.retry_connection",{connection_id:i.connection_id||i.name}),u=pe(c,__("Connection retry initiated successfully"));h("success",u.requiresAuth?__("Retry Initiated"):__("Success"),u.message),await re(),H("connection-updated",{action:"retry",platform:i.platform_type})}catch(c){console.error("Error retrying connection:",c),h("error",__("Error"),c.message||__("Failed to retry connection"))}finally{Ce(n,I.value)}};return ve(async()=>{await re(),setInterval(async()=>{T.value.some(i=>i.connection_status==="Pending")&&!V.value&&(console.log(__("Auto-refreshing due to pending connections")),await re())},3e4)}),(n,i)=>(y(),v("div",va,[e("div",ha,[e("div",null,[e("h1",ka,s(n.__("External Connections")),1),e("p",Ca,s(n.__("Manage your connections to external platforms")),1)]),r(l(O),{onClick:re,loading:V.value,variant:"outline"},{prefix:b(()=>[r(l(k),{name:"refresh-cw",class:"w-4 h-4"})]),default:b(()=>[x(" "+s(n.__("Refresh")),1)]),_:1},8,["loading"])]),e("div",xa,[(y(!0),v(Q,null,X(n.allPlatforms,c=>(y(),v("div",{key:n.typeKey,class:"bg-white rounded-lg border border-gray-200 shadow-sm"},[e("div",wa,[e("div",$a,[e("div",{class:de(["w-10 h-10 rounded-lg flex items-center justify-center",n.typeData.color])},[r(l(k),{name:n.typeData.icon,class:"w-5 h-5 text-white"},null,8,["name"])],2),e("div",null,[e("h3",Va,s(n.__(n.typeData.title)),1),e("p",Aa,s(n.typeData.platforms.length)+" "+s(n.__("platforms")),1)])])]),e("div",Ea,[(y(!0),v(Q,null,X(n.typeData.platforms,u=>(y(),v("div",{key:u.id,class:de(["border rounded-lg p-3 transition-all duration-200 hover:shadow-md",u.color])},[e("div",Sa,[e("div",Ta,[e("span",Oa,s(u.icon),1),e("div",null,[e("h4",Ua,s(u.name),1),e("p",ja,s(n.__(u.description)),1)])]),r(l(G),{variant:U(u.id),size:"sm"},{default:b(()=>[x(s(he(u.id)),1)]),_:2},1032,["variant"])]),C(u.id).length>0?(y(),v("div",Pa,[e("div",Fa,s(n.__("Connected Accounts:")),1),e("div",qa,[(y(!0),v(Q,null,X(C(u.id),E=>(y(),v("div",{key:E.external_account_id,class:"flex items-center gap-2 text-xs"},[e("div",Da,[r(l(k),{name:"check",class:"w-2 h-2 text-green-600"})]),e("span",za,s(E.account_name),1),E.is_primary?(y(),D(l(G),{key:0,variant:"subtle",size:"xs"},{default:b(()=>[x(s(n.__("Primary")),1)]),_:1})):$("",!0)]))),128))])])):$("",!0),e("div",Ra,[e("div",Ia,[(y(!0),v(Q,null,X(u.features,E=>(y(),D(l(G),{key:E,variant:"outline",size:"xs"},{default:b(()=>[x(s(n.__(E)),1)]),_:2},1024))),128))])]),e("div",Ma,[g(u.id)?$("",!0):(y(),D(l(O),{key:0,onClick:E=>Re(u),variant:"solid",size:"sm",loading:I.value.includes(u.id)},{prefix:b(()=>[r(l(k),{name:"link",class:"w-3 h-3"})]),default:b(()=>[x(" "+s(n.__("Connect")),1)]),_:2},1032,["onClick","loading"])),ie(u.id)?(y(),D(l(O),{key:1,onClick:E=>Ne(u.id),variant:"outline",size:"sm",theme:"red",loading:B.value.includes(u.id),disabled:B.value.includes(u.id)},{prefix:b(()=>[r(l(k),{name:"unlink",class:"w-3 h-3"})]),default:b(()=>[x(" "+s(n.__("Disconnect")),1)]),_:2},1032,["onClick","loading","disabled"])):$("",!0),ie(u.id)?(y(),D(l(O),{key:2,onClick:E=>Ie(u.id),variant:"ghost",size:"sm",disabled:I.value.includes(u.id)||B.value.includes(u.id)},{prefix:b(()=>[r(l(k),{name:"edit-2",class:"w-3 h-3"})]),default:b(()=>[x(" "+s(n.__("Edit")),1)]),_:2},1032,["onClick","disabled"])):$("",!0),se(u.id)?(y(),D(l(O),{key:3,onClick:E=>We(u.id),variant:"outline",size:"sm",loading:N.value.includes(u.id),disabled:N.value.includes(u.id)||B.value.includes(u.id)},{prefix:b(()=>[r(l(k),{name:"refresh-cw",class:"w-3 h-3"})]),default:b(()=>[x(" "+s(n.__("Sync")),1)]),_:2},1032,["onClick","loading","disabled"])):$("",!0),se(u.id)?(y(),D(l(O),{key:4,onClick:E=>Me(u.id),variant:"ghost",size:"sm"},{prefix:b(()=>[r(l(k),{name:"settings",class:"w-3 h-3"})]),default:b(()=>[x(" "+s(n.__("Settings")),1)]),_:2},1032,["onClick"])):$("",!0),ue(u.id)?(y(),D(l(O),{key:5,onClick:E=>Ye(u.id),variant:"outline",size:"sm",theme:"orange",loading:I.value.includes(u.id)},{prefix:b(()=>[r(l(k),{name:"rotate-ccw",class:"w-3 h-3"})]),default:b(()=>[x(" "+s(n.__("Retry")),1)]),_:2},1032,["onClick","loading"])):$("",!0)])],2))),128))])]))),128))]),q.value?(y(),D(l($e),{key:0,modelValue:q.value,"onUpdate:modelValue":i[1]||(i[1]=c=>q.value=c),options:{title:Ae("connect"),size:"2xl"}},{"body-content":b(()=>[o.value?(y(),v("div",La,[e("div",Ba,[e("span",Na,s(o.value.icon),1),e("div",null,[e("h3",Ha,s(o.value.name),1),e("p",Za,s(n.__(o.value.description)),1)])]),(y(),D(je(te.value),{modelValue:J.value,"onUpdate:modelValue":i[0]||(i[0]=c=>J.value=c),platform:o.value,"is-edit":!1,onSubmit:Ze,onCancel:Oe},null,40,["modelValue","platform"]))])):$("",!0)]),_:1},8,["modelValue","options"])):$("",!0),m.value?(y(),D(l($e),{key:1,modelValue:m.value,"onUpdate:modelValue":i[3]||(i[3]=c=>m.value=c),options:{title:Ae("edit"),size:"2xl"}},{"body-content":b(()=>[d.value&&o.value?(y(),v("div",Ga,[e("div",Ka,[e("span",Wa,s(o.value.icon),1),e("div",null,[e("h3",Ya,s(o.value.name),1),e("p",Ja,s(n.__("Edit connection settings")),1),r(l(G),{variant:U(o.value.id),size:"sm",class:"mt-1"},{default:b(()=>[x(s(he(o.value.id)),1)]),_:1},8,["variant"])])]),t(o.value.id)==="Pending"?(y(),v("div",Qa,[e("div",Xa,[r(l(k),{name:"clock",class:"w-4 h-4 text-yellow-600"}),e("span",el,s(n.__("This connection is pending authentication. You can edit settings or disconnect if needed.")),1)])])):t(o.value.id)==="Failed"?(y(),v("div",tl,[e("div",sl,[r(l(k),{name:"alert-triangle",class:"w-4 h-4 text-red-600"}),e("span",nl,s(n.__("This connection failed to authenticate. You can edit settings and try again.")),1)])])):t(o.value.id)==="Disconnected"?(y(),v("div",ol,[e("div",al,[r(l(k),{name:"unlink",class:"w-4 h-4 text-gray-600"}),e("span",ll,s(n.__("This connection has been disconnected. You can edit settings to reconnect.")),1)])])):$("",!0),d.value.accounts&&d.value.accounts.length>0?(y(),v("div",il,[e("h4",rl,[r(l(k),{name:"users",class:"w-4 h-4"}),x(" "+s(n.__("Currently Connected Accounts")),1)]),e("div",cl,[(y(!0),v(Q,null,X(d.value.accounts,c=>(y(),v("div",{key:c.external_account_id,class:"flex items-center justify-between p-2 bg-white rounded border"},[e("div",dl,[e("div",ul,[r(l(k),{name:"check",class:"w-3 h-3 text-green-600"})]),e("div",null,[e("span",_l,s(c.account_name),1),e("div",ml,s(c.account_type),1)])]),e("div",gl,[c.is_primary?(y(),D(l(G),{key:0,variant:"subtle",size:"xs"},{default:b(()=>[x(s(n.__("Primary")),1)]),_:1})):$("",!0),r(l(G),{variant:c.is_active?"success":"gray",size:"xs"},{default:b(()=>[x(s(c.is_active?n.__("Active"):n.__("Inactive")),1)]),_:2},1032,["variant"])])]))),128))])])):t(o.value.id)==="Pending"?(y(),v("div",pl,[e("div",yl,[r(l(k),{name:"clock",class:"w-4 h-4 text-yellow-600"}),e("span",fl,s(n.__("No accounts connected yet. Complete authentication to see connected accounts.")),1)])])):$("",!0),(y(),D(je(te.value),{modelValue:_.value,"onUpdate:modelValue":i[2]||(i[2]=c=>_.value=c),platform:o.value,connectionType:o.value,isEdit:!0,existingConnection:d.value,connectedAccounts:d.value.accounts||[],onSubmit:Ge,onCancel:Ue},null,40,["modelValue","platform","connectionType","existingConnection","connectedAccounts"]))])):$("",!0)]),_:1},8,["modelValue","options"])):$("",!0),F.value?(y(),D(l($e),{key:2,modelValue:F.value,"onUpdate:modelValue":i[5]||(i[5]=c=>F.value=c),options:{title:n.__("Account Settings"),size:"2xl"}},{"body-content":b(()=>[a.value?(y(),v("div",bl,[e("div",vl,[e("h3",hl,s(n.__("Connection Information")),1),e("div",kl,[e("div",null,[e("span",Cl,s(n.__("Platform:")),1),e("span",xl,s(a.value.platform_type),1)]),e("div",null,[e("span",wl,s(n.__("Status:")),1),r(l(G),{variant:a.value.connection_status==="Connected"?"success":qe(a.value.connection_status),size:"sm",class:"ml-2"},{default:b(()=>[x(s(n.__(a.value.connection_status)||n.__("Unknown")),1)]),_:1},8,["variant"])]),e("div",null,[e("span",$l,s(n.__("Created:")),1),e("span",Vl,s(Te(a.value.creation)),1)]),e("div",null,[e("span",Al,s(n.__("Last Sync:")),1),e("span",El,s(Te(a.value.last_sync_time)),1)])])]),a.value.accounts&&a.value.accounts.length>0?(y(),v("div",Sl,[e("h3",Tl,s(n.__("Connected Accounts")),1),e("div",Ol,[(y(!0),v(Q,null,X(a.value.accounts,c=>(y(),v("div",{key:c.external_account_id,class:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors"},[e("div",Ul,[e("div",jl,[r(l(k),{name:"user",class:"w-4 h-4 text-gray-600"})]),e("div",null,[e("div",Pl,s(c.account_name),1),e("div",Fl,s(c.account_type)+" • "+s(c.external_account_id),1)])]),e("div",ql,[c.is_primary?(y(),D(l(G),{key:0,variant:"success",size:"sm"},{default:b(()=>[x(s(n.__("Primary")),1)]),_:1})):$("",!0),r(l(G),{variant:c.is_active?"success":"gray",size:"sm"},{default:b(()=>[x(s(c.is_active?n.__("Active"):n.__("Inactive")),1)]),_:2},1032,["variant"])])]))),128))])])):(y(),v("div",Dl,[r(l(k),{name:"users",class:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e("p",zl,s(n.__("No accounts connected")),1)])),a.value.accounts&&a.value.accounts.length>0?(y(),v("div",Rl,[e("h3",Il,s(n.__("Connection Statistics")),1),e("div",Ml,[e("div",Ll,[e("div",Bl,s(a.value.total_api_calls||0),1),e("div",Nl,s(n.__("Total API Calls")),1)]),e("div",Hl,[e("div",Zl,s(a.value.successful_calls||0),1),e("div",Gl,s(n.__("Successful Calls")),1)]),e("div",Kl,[e("div",Wl,s(a.value.failed_calls||0),1),e("div",Yl,s(n.__("Failed Calls")),1)])]),e("div",Jl,[e("div",Ql,[e("span",Xl,s(n.__("Success Rate:")),1),e("span",{class:de(["font-medium",De(a.value)])},s(Se(a.value))+"% ",3)])])])):$("",!0)])):$("",!0)]),actions:b(()=>[e("div",ei,[a.value.connection_status==="Connected"?(y(),D(l(O),{key:0,onClick:i[4]||(i[4]=c=>He(a.value)),variant:"outline",size:"sm",loading:ee.value},{prefix:b(()=>[r(l(k),{name:"refresh-cw",class:"w-3 h-3"})]),default:b(()=>[x(" "+s(n.__("Refresh")),1)]),_:1},8,["loading"])):$("",!0),r(l(O),{onClick:ze,variant:"ghost"},{default:b(()=>[x(s(n.__("Close")),1)]),_:1})])]),_:1},8,["modelValue","options"])):$("",!0)]))}},ni=be(ti,[["__scopeId","data-v-7c94bd5d"]]);export{ni as default};
//# sourceMappingURL=APIIntegrationList-0330ac6a.js.map
