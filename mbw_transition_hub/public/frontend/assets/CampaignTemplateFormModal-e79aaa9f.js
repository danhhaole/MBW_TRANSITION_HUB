import{a2 as be,_ as xe,c as I,r as N,C as Q,w as le,o as f,e as v,d as e,J as E,t as c,f as m,b as w,u,X as O,l as k,a3 as Se,h as x,j as C,a0 as K,k as Z,D as z,E as P,a4 as we,F as ke,i as Ce,a1 as ee,$ as re,Q as Te}from"./index-d2648b45.js";class Ae{constructor(){this.repository=be}async getList(i={}){try{const o=this.buildSearchFilters(i),n=await this.repository.getList(o);return n.success?{success:!0,data:{data:this.processStepList(n.data),total:n.pagination.total,...n.pagination}}:n}catch(o){return console.error("Service error in getList:",o),{success:!1,error:o.message||"Failed to fetch template steps"}}}async getStepsByTemplate(i,o={}){try{const n=await this.repository.getStepsByTemplate(i,o);return n.success?{success:!0,data:this.processStepList(n.data)}:n}catch(n){return console.error("Service error in getStepsByTemplate:",n),{success:!1,error:n.message||"Failed to fetch template steps"}}}processStepList(i){return!i||!Array.isArray(i)?[]:i.map(o=>({...o,action_type_display:this.getActionTypeDisplay(o.action_type),delay_display:this.getDelayDisplay(o.delay_in_days),has_content:!!(o.template_content&&o.template_content.trim()),has_config:!!(o.action_config&&Object.keys(o.action_config).length>0)}))}buildSearchFilters(i={}){const{search_text:o,filters:n={},...d}=i;let y={...n};return o&&o.trim()&&(y.campaign_step_name=["like",`%${o.trim()}%`]),{...d,filters:y}}async getById(i){try{const o=await this.repository.getById(i);return o.success&&o.data?{success:!0,data:this.processStep(o.data)}:o}catch(o){return console.error("Service error in getById:",o),{success:!1,error:o.message||"Failed to fetch template step"}}}processStep(i){return{...i,action_type_display:this.getActionTypeDisplay(i.action_type),delay_display:this.getDelayDisplay(i.delay_in_days),has_content:!!(i.template_content&&i.template_content.trim()),has_config:!!(i.action_config&&Object.keys(i.action_config).length>0)}}async create(i){try{const o=this.validateStep(i,"create");if(o.length>0)return{success:!1,error:o.join(", ")};if(!i.step_order){const y=await this.getNextStepOrder(i.template);i.step_order=y}const n=this.prepareStepForSave(i,"create"),d=await this.repository.create(n);return d.success&&await this.logActivity("create",d.data),d}catch(o){return console.error("Service error in create:",o),{success:!1,error:o.message||"Failed to create template step"}}}async update(i,o){try{const n=this.validateStep(o,"update");if(n.length>0)return{success:!1,error:n.join(", ")};const d=this.prepareStepForSave(o,"update"),y=await this.repository.update(i,d);return y.success&&await this.logActivity("update",y.data,i),y}catch(n){return console.error("Service error in update:",n),{success:!1,error:n.message||"Failed to update template step"}}}async delete(i){try{const o=await this.repository.getById(i);if(!o.success)return o;const n=o.data,d=n.template,y=n.step_order,t=await this.repository.delete(i);return t.success&&(await this.reorderStepsAfterDelete(d,y),await this.logActivity("delete",null,i)),t}catch(o){return console.error("Service error in delete:",o),{success:!1,error:o.message||"Failed to delete template step"}}}async reorderStepsAfterDelete(i,o){try{const n=await this.repository.getStepsByTemplate(i,{filters:{step_order:[">",o]}});if(n.success&&n.data.length>0){const d=n.data.map(y=>({name:y.name,step_order:y.step_order-1}));await this.repository.reorderSteps(i,d)}}catch(n){console.error("Error reordering steps after delete:",n)}}async getNextStepOrder(i){try{const o=await this.repository.getStepsByTemplate(i);return!o.success||!o.data.length?1:Math.max(...o.data.map(d=>d.step_order||0))+1}catch(o){return console.error("Error getting next step order:",o),1}}validateStep(i,o="create"){const n=[];(!i.template||!i.template.trim())&&n.push("Template is required"),(!i.campaign_step_name||!i.campaign_step_name.trim())&&n.push("Step name is required"),(!i.action_type||!i.action_type.trim())&&n.push("Action type is required"),i.campaign_step_name&&i.campaign_step_name.length>150&&n.push("Step name must be less than 150 characters"),i.step_order&&(i.step_order<1||i.step_order>999)&&n.push("Step order must be between 1 and 999"),i.delay_in_days&&(i.delay_in_days<0||i.delay_in_days>365)&&n.push("Delay must be between 0 and 365 days");const d=["SEND_EMAIL","SEND_SMS","MANUAL_CALL","MANUAL_TASK"];if(i.action_type&&!d.includes(i.action_type)&&n.push("Invalid action type"),i.action_config)try{typeof i.action_config=="string"&&JSON.parse(i.action_config)}catch{n.push("Invalid action config JSON format")}return n}prepareStepForSave(i,o="create"){const n={...i};if(n.campaign_step_name&&(n.campaign_step_name=n.campaign_step_name.trim()),n.template_content&&(n.template_content=n.template_content.trim()),o==="create"&&(n.delay_in_days=n.delay_in_days!==void 0?n.delay_in_days:0),n.action_config&&typeof n.action_config=="string")try{n.action_config=JSON.parse(n.action_config)}catch{}return n}async logActivity(i,o,n=null){try{console.log(`Template Step ${i}:`,n||(o==null?void 0:o.name),o)}catch(d){console.error("Error logging activity:",d)}}getActionTypeDisplay(i){return{SEND_EMAIL:"Send Email",SEND_SMS:"Send SMS",MANUAL_CALL:"Manual Call",MANUAL_TASK:"Manual Task"}[i]||i}getDelayDisplay(i){return!i||i===0?"Immediate":i===1?"1 day":`${i} days`}async moveStep(i,o){try{const n=await this.repository.getById(i);if(!n.success)return n;const d=n.data,y=d.step_order,t=d.template,j=o==="up"?y-1:y+1,F=await this.repository.getStepsByTemplate(t,{filters:{step_order:j}});if(!F.success)return F;const M=F.data[0];if(!M)return{success:!1,error:`Cannot move step ${o}`};const B=[this.repository.update(i,{step_order:j}),this.repository.update(M.name,{step_order:y})];return(await Promise.all(B)).filter(T=>!T.success).length>0?{success:!1,error:"Failed to move step"}:{success:!0,message:`Step moved ${o} successfully`}}catch(n){return console.error("Service error in moveStep:",n),{success:!1,error:n.message||"Failed to move step"}}}async duplicateStep(i){try{const o=await this.repository.getById(i);if(!o.success)return o;const n=o.data,d={template:n.template,campaign_step_name:`${n.campaign_step_name} (Copy)`,action_type:n.action_type,delay_in_days:n.delay_in_days,template_content:n.template_content,action_config:n.action_config},y=await this.getNextStepOrder(n.template);return d.step_order=y,await this.create(d)}catch(o){return console.error("Service error in duplicateStep:",o),{success:!1,error:o.message||"Failed to duplicate step"}}}}const U=new Ae;const Ee={key:0,class:"fixed z-50 inset-0 overflow-y-auto"},Ve={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},De={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},Me={class:"bg-white pt-5 pb-4 sm:py-6 sm:pb-4"},Ne={class:"flex items-center justify-between"},Oe={class:"text-lg px-5 leading-6 font-medium text-gray-900"},Fe={key:0,class:"mt-4"},Le={class:"bg-white px-4 pt-5 pb-4 sm:p-6 max-h-[70vh] overflow-y-auto"},Ue={key:0,class:"grid grid-cols-1 gap-6"},je={class:"block text-sm font-medium text-gray-700 mb-2"},Be={key:0,class:"mt-1 text-sm text-red-600"},$e={class:"block text-sm font-medium text-gray-700 mb-2"},Ie={key:0,class:"mt-1 text-sm text-red-600"},ze={class:"block text-sm font-medium text-gray-700 mb-2"},Je=["placeholder","disabled"],qe={key:0,class:"mt-1 text-sm text-red-600"},Re={class:"flex items-center"},Ke=["disabled"],Pe={class:"ml-2 block text-sm text-gray-900"},He={key:1,class:"space-y-4"},Qe={class:"flex items-center justify-between"},We={class:"text-lg font-medium text-gray-900"},Xe={class:"text-sm text-gray-500"},Ge={key:0,class:"flex justify-center py-4"},Ye={class:"flex items-center text-gray-600"},Ze={key:1,class:"text-center py-6 bg-gray-50 rounded-lg"},et={class:"text-gray-500 text-sm"},tt={key:2,class:"space-y-2"},st={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-4 hover:bg-gray-100 transition-colors"},at={class:"flex items-center justify-between"},ot={class:"flex-1"},nt={class:"flex items-center space-x-3"},it={class:"flex items-center justify-center w-6 h-6 bg-indigo-100 text-indigo-800 text-xs font-medium rounded-full"},lt={class:"text-sm font-medium text-gray-900"},rt={class:"flex items-center space-x-2 text-xs text-gray-500"},ct={key:0},dt={class:"flex items-center space-x-1"},pt={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},mt={class:"flex items-center justify-between mb-4"},ut={class:"text-lg font-medium text-gray-900"},_t={class:"space-y-4"},yt={class:"grid grid-cols-2 gap-4"},gt={class:"block text-sm font-medium text-gray-700 mb-2"},ft={key:0,class:"mt-1 text-sm text-red-600"},vt={class:"block text-sm font-medium text-gray-700 mb-2"},ht={key:0,class:"mt-1 text-sm text-red-600"},bt={class:"block text-sm font-medium text-gray-700 mb-2"},xt={class:"mt-1 text-xs text-gray-500"},St={key:0,class:"mt-1 text-sm text-red-600"},wt={class:"block text-sm font-medium text-gray-700 mb-2"},kt=["placeholder","disabled"],Ct={key:0,class:"mt-1 text-sm text-red-600"},Tt={class:"block text-sm font-medium text-gray-700 mb-2"},At=["placeholder","disabled"],Et={class:"mt-1 text-xs text-gray-500"},Vt={key:0,class:"mt-1 text-sm text-red-600"},Dt={class:"bg-gray-50 p-3 rounded-md border border-gray-200"},Mt={class:"flex items-center space-x-3"},Nt={class:"flex-shrink-0"},Ot={class:"w-6 h-6 bg-indigo-100 text-indigo-800 text-xs font-medium rounded-full flex items-center justify-center"},Ft={class:"flex-1"},Lt={class:"text-sm font-medium text-gray-900"},Ut={class:"text-xs text-gray-500"},jt={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},Bt={key:3,class:"mt-6 border-t border-gray-200 pt-6"},$t={class:"bg-green-50 border border-green-200 rounded-lg p-4"},It={class:"flex items-center justify-between mb-4"},zt={class:"text-lg font-medium text-gray-900"},Jt={class:"space-y-4"},qt={class:"grid grid-cols-2 gap-4"},Rt={class:"block text-sm font-medium text-gray-700 mb-2"},Kt={key:0,class:"mt-1 text-sm text-red-600"},Pt={class:"block text-sm font-medium text-gray-700 mb-2"},Ht={key:0,class:"mt-1 text-sm text-red-600"},Qt={class:"block text-sm font-medium text-gray-700 mb-2"},Wt={class:"mt-1 text-xs text-gray-500"},Xt={key:0,class:"mt-1 text-sm text-red-600"},Gt={class:"block text-sm font-medium text-gray-700 mb-2"},Yt=["placeholder","disabled"],Zt={key:0,class:"mt-1 text-sm text-red-600"},es={class:"block text-sm font-medium text-gray-700 mb-2"},ts=["placeholder","disabled"],ss={class:"mt-1 text-xs text-gray-500"},as={key:0,class:"mt-1 text-sm text-red-600"},os={class:"bg-green-50 p-3 rounded-md border border-green-200"},ns={class:"flex items-center space-x-3"},is={class:"flex-shrink-0"},ls={class:"w-6 h-6 bg-green-100 text-green-800 text-xs font-medium rounded-full flex items-center justify-center"},rs={class:"flex-1"},cs={class:"text-sm font-medium text-gray-900"},ds={class:"text-xs text-gray-500"},ps={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},ms={key:2,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md"},us={class:"flex"},_s={class:"ml-3"},ys={class:"text-sm font-medium text-red-800"},gs={class:"mt-1 text-sm text-red-700"},fs={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},vs={__name:"CampaignTemplateFormModal",props:{modelValue:{type:Boolean,default:!1},template:{type:Object,default:null}},emits:["update:modelValue","saved","step-changed"],setup(te,{emit:i}){const o=te,n=i,{showSuccess:d,showError:y}=Te(),t=a=>a,j=I({get:()=>o.modelValue,set:a=>n("update:modelValue",a)}),F=I(()=>{var a,s;return((a=o.template)==null?void 0:a.name)||((s=D.value)==null?void 0:s.name)||null}),M=I(()=>!!F.value),B=I(()=>{const a=[{label:t("Template Info"),name:"template"}];return M.value&&a.push({label:A.value.length>0?`${t("Template Steps")} (${A.value.length})`:t("Template Steps"),name:"steps"}),a}),se=I(()=>T.value?t("Saving..."):M.value?t("Update Template"):t("Create Template")),W=I(()=>{var a;return((a=B.value[J.value])==null?void 0:a.name)||"template"}),T=N(!1),$=N(""),S=Q({}),J=N(0),D=N(null),A=N([]),X=N(!1),q=N(!1),V=N(null),b=N(!1),_=Q({}),r=Q({campaign_step_name:"",action_type:"",step_order:1,delay_in_days:0,template_content:"",action_config_string:""}),g=Q({template_name:"",campaign_type:"",description:"",is_active:!0}),ce=[{label:t("Select campaign type..."),value:"",disabled:!0},{label:t("Email Campaign"),value:"Email"},{label:t("SMS Campaign"),value:"SMS"},{label:t("Advertisement Campaign"),value:"Ads"},{label:t("Social Media Campaign"),value:"Social Media"},{label:t("Direct Mail Campaign"),value:"Direct Mail"}],ae=[{label:t("Select action type..."),value:"",disabled:!0},{label:t("Send Email"),value:"SEND_EMAIL"},{label:t("Send SMS"),value:"SEND_SMS"},{label:t("Manual Call"),value:"MANUAL_CALL"},{label:t("Manual Task"),value:"MANUAL_TASK"}],de=()=>{g.template_name="",g.campaign_type="",g.description="",g.is_active=!0,Object.keys(S).forEach(a=>{delete S[a]}),$.value="",J.value=0,D.value=null,A.value=[],q.value=!1,R()},oe=a=>{a&&(g.template_name=a.template_name||"",g.campaign_type=a.campaign_type||"",g.description=a.description||"",g.is_active=a.is_active===1||a.is_active===!0,D.value=a,a.name&&L(a.name))},L=async a=>{if(a){X.value=!0;try{const s=await U.getStepsByTemplate(a);s.success?A.value=s.data||[]:(console.error("Error loading template steps:",s.error),A.value=[])}catch(s){console.error("Error loading template steps:",s),A.value=[]}finally{X.value=!1}}},pe=async()=>{if(!D.value&&!M.value){y(t("Please save the template first before adding steps"));return}R(),V.value=null;try{const s=await ge();r.step_order=s}catch(s){console.error("Error getting next step order:",s),r.step_order=A.value.length+1}q.value=!0,await ee();const a=document.querySelector(".bg-green-50.border-green-200");if(a){a.scrollIntoView({behavior:"smooth",block:"start"});const s=a.querySelector('input[type="text"]');s&&setTimeout(()=>s.focus(),300)}},me=async a=>{R(),V.value=a,ye(a),await ee();const s=document.querySelector(".bg-blue-50.border-blue-200");if(s){const l=s.querySelector('input[type="text"]');l&&setTimeout(()=>l.focus(),100)}},ue=async a=>{var s,l;if(confirm(t("Are you sure you want to delete this step?")))try{const h=await U.delete(a.name);h.success?(d(t("Step deleted successfully")),L(((s=D.value)==null?void 0:s.name)||((l=o.template)==null?void 0:l.name)),n("step-changed")):y(h.error||t("Failed to delete step"))}catch(h){console.error("Error deleting step:",h),y(t("An error occurred while deleting step"))}},ne=async(a,s)=>{var l,h;try{const p=await U.moveStep(a.name,s);p.success?(d(p.message||t("Step moved successfully")),L(((l=D.value)==null?void 0:l.name)||((h=o.template)==null?void 0:h.name)),n("step-changed")):y(p.error||t("Failed to move step"))}catch(p){console.error("Error moving step:",p),y(t("An error occurred while moving step"))}},_e=async a=>{var s,l;try{const h=((s=D.value)==null?void 0:s.name)||((l=o.template)==null?void 0:l.name),p={template:h,campaign_step_name:`${a.campaign_step_name} (Copy)`,action_type:a.action_type,step_order:A.value.length+1,delay_in_days:a.delay_in_days||0,template_content:a.template_content||"",action_config:a.action_config||null},Y=await U.create(p);Y.success?(d(t("Step copied successfully")),L(h),n("step-changed")):y(Y.error||t("Failed to copy step"))}catch(h){console.error("Error copying step:",h),y(t("An error occurred while copying step"))}},R=()=>{r.campaign_step_name="",r.action_type="",r.step_order=1,r.delay_in_days=0,r.template_content="",r.action_config_string="",Object.keys(_).forEach(a=>{delete _[a]}),V.value=null},ye=a=>{a&&(r.campaign_step_name=a.campaign_step_name||"",r.action_type=a.action_type||"",r.step_order=a.step_order||1,r.delay_in_days=a.delay_in_days||0,r.template_content=a.template_content||"",a.action_config?typeof a.action_config=="object"?r.action_config_string=JSON.stringify(a.action_config,null,2):r.action_config_string=a.action_config:r.action_config_string="")},ge=async()=>{var s,l;const a=((s=D.value)==null?void 0:s.name)||((l=o.template)==null?void 0:l.name);if(!a)return 1;try{return await U.getNextStepOrder(a)||A.value.length+1}catch{return A.value.length+1}},fe=()=>{Object.keys(_).forEach(s=>{delete _[s]});let a=!0;if(!r.campaign_step_name||!r.campaign_step_name.trim()?(_.campaign_step_name=t("Step name is required"),a=!1):r.campaign_step_name.length>150&&(_.campaign_step_name=t("Step name must be less than 150 characters"),a=!1),(!r.action_type||!r.action_type.trim())&&(_.action_type=t("Action type is required"),a=!1),(r.delay_in_days<0||r.delay_in_days>365)&&(_.delay_in_days=t("Delay must be between 0 and 365 days"),a=!1),r.action_config_string&&r.action_config_string.trim())try{JSON.parse(r.action_config_string)}catch{_.action_config=t("Invalid JSON format"),a=!1}return a},ie=async()=>{var a,s;if(fe()){b.value=!0;try{const l=((a=D.value)==null?void 0:a.name)||((s=o.template)==null?void 0:s.name),h={template:l,campaign_step_name:r.campaign_step_name.trim(),action_type:r.action_type,step_order:r.step_order,delay_in_days:r.delay_in_days,template_content:r.template_content?r.template_content.trim():""};if(r.action_config_string&&r.action_config_string.trim())try{h.action_config=JSON.parse(r.action_config_string)}catch{h.action_config=r.action_config_string}let p;V.value?p=await U.update(V.value.name,h):p=await U.create(h),p.success?(d(p.message||(V.value?t("Step updated successfully"):t("Step added successfully"))),q.value=!1,V.value=null,R(),L(l),n("step-changed")):p.error.includes("campaign_step_name")?_.campaign_step_name=p.error:p.error.includes("action_type")?_.action_type=p.error:y(p.error)}catch(l){console.error("Error submitting step form:",l),y(t("An error occurred while saving step"))}finally{b.value=!1}}},H=()=>{q.value=!1,V.value=null,R()},ve=()=>{Object.keys(S).forEach(s=>{delete S[s]});let a=!0;return!g.template_name||!g.template_name.trim()?(S.template_name=t("Template name is required"),a=!1):g.template_name.length>150&&(S.template_name=t("Template name must be less than 150 characters"),a=!1),(!g.campaign_type||!g.campaign_type.trim())&&(S.campaign_type=t("Campaign type is required"),a=!1),g.description&&g.description.length>500&&(S.description=t("Description must be less than 500 characters"),a=!1),a},he=async()=>{var a;if(ve()){T.value=!0,$.value="";try{const s={template_name:g.template_name.trim(),campaign_type:g.campaign_type,description:g.description?g.description.trim():"",is_active:g.is_active?1:0};let l;F.value?l=await re.update(F.value,s):l=await re.create(s),l.success?(d(l.message||(M.value?t("Template updated successfully"):t("Template created successfully"))),M.value?((a=l.data)!=null&&a.name&&await L(l.data.name),j.value=!1,n("saved",l.data)):(D.value=l.data,await L(l.data.name),J.value=B.value.findIndex(h=>h.name==="steps"),n("saved",l.data))):l.error.includes("template_name")?S.template_name=l.error:l.error.includes("campaign_type")?S.campaign_type=l.error:$.value=l.error}catch(s){console.error("Error submitting form:",s),$.value=t("An error occurred while saving template")}finally{T.value=!1}}},G=()=>{T.value||(j.value=!1)};return le(()=>o.modelValue,a=>{a&&(de(),o.template&&ee(()=>{oe(o.template)}))},{immediate:!0}),le(()=>o.template,a=>{a&&o.modelValue&&oe(a)}),(a,s)=>j.value?(f(),v("div",Ee,[e("div",Ve,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:G}),s[26]||(s[26]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen"},"​",-1)),e("div",De,[e("form",{onSubmit:E(he,["prevent"])},[e("div",Me,[e("div",Ne,[e("h3",Oe,c(M.value?t("Edit Campaign Template"):t("Create Campaign Template")),1),m(u(k),{variant:"ghost",size:"sm",onClick:G,class:"px-6"},{icon:w(()=>[m(u(O),{name:"x",class:"w-6 h-6"})]),_:1})]),B.value.length>0?(f(),v("div",Fe,[m(u(Se),{modelValue:J.value,"onUpdate:modelValue":s[0]||(s[0]=l=>J.value=l),tabs:B.value},null,8,["modelValue","tabs"])])):x("",!0)]),e("div",Le,[W.value==="template"?(f(),v("div",Ue,[e("div",null,[e("label",je,[C(c(t("Template Name"))+" ",1),s[15]||(s[15]=e("span",{class:"text-red-500"},"*",-1))]),m(u(K),{modelValue:g.template_name,"onUpdate:modelValue":s[1]||(s[1]=l=>g.template_name=l),type:"text",placeholder:t("Enter template name..."),disabled:T.value,class:"w-full"},null,8,["modelValue","placeholder","disabled"]),S.template_name?(f(),v("div",Be,c(S.template_name),1)):x("",!0)]),e("div",null,[e("label",$e,[C(c(t("Campaign Type"))+" ",1),s[16]||(s[16]=e("span",{class:"text-red-500"},"*",-1))]),m(u(Z),{type:"select",modelValue:g.campaign_type,"onUpdate:modelValue":s[2]||(s[2]=l=>g.campaign_type=l),options:ce,disabled:T.value,class:"w-full"},null,8,["modelValue","disabled"]),S.campaign_type?(f(),v("div",Ie,c(S.campaign_type),1)):x("",!0)]),e("div",null,[e("label",ze,c(t("Description")),1),z(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=l=>g.description=l),rows:"3",placeholder:t("Enter template description..."),disabled:T.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,8,Je),[[P,g.description]]),S.description?(f(),v("div",qe,c(S.description),1)):x("",!0)]),e("div",Re,[z(e("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>g.is_active=l),type:"checkbox",disabled:T.value,class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,8,Ke),[[we,g.is_active]]),e("label",Pe,c(t("Active")),1)])])):x("",!0),W.value==="steps"?(f(),v("div",He,[e("div",Qe,[e("div",null,[e("h3",We,c(t("Template Steps")),1),e("p",Xe,c(t("Define the steps for this campaign template")),1)]),m(u(k),{type:"button",variant:"solid",theme:"gray",onClick:E(pe,["stop"])},{prefix:w(()=>s[17]||(s[17]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)])),default:w(()=>[C(" "+c(t("Add Step")),1)]),_:1})]),X.value?(f(),v("div",Ge,[e("div",Ye,[s[18]||(s[18]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),C(" "+c(t("Loading steps...")),1)])])):A.value.length===0?(f(),v("div",Ze,[s[19]||(s[19]=e("div",{class:"text-gray-400 mb-2"},[e("svg",{class:"mx-auto h-8 w-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])],-1)),e("p",et,c(t('No steps defined yet. Click "Add Step" to get started.')),1)])):(f(),v("div",tt,[(f(!0),v(ke,null,Ce(A.value,(l,h)=>(f(),v("div",{key:l.name},[!V.value||V.value.name!==l.name?(f(),v("div",st,[e("div",at,[e("div",ot,[e("div",nt,[e("span",it,c(l.step_order),1),e("div",null,[e("h4",lt,c(l.campaign_step_name),1),e("div",rt,[e("span",null,c(l.action_type),1),l.delay_in_days>0?(f(),v("span",ct,"• "+c(l.delay_in_days)+" "+c(t("days delay")),1)):x("",!0)])])])]),e("div",dt,[m(u(k),{type:"button",variant:"ghost",size:"sm",onClick:E(p=>ne(l,"up"),["stop"]),disabled:h===0,title:t("Move up")},{icon:w(()=>[m(u(O),{name:"chevron-up",class:"w-4 h-4"})]),_:2},1032,["onClick","disabled","title"]),m(u(k),{type:"button",variant:"ghost",size:"sm",onClick:E(p=>ne(l,"down"),["stop"]),disabled:h===A.value.length-1,title:t("Move down")},{icon:w(()=>[m(u(O),{name:"chevron-down",class:"w-4 h-4"})]),_:2},1032,["onClick","disabled","title"]),s[20]||(s[20]=e("div",{class:"border-l border-gray-300 h-4 mx-1"},null,-1)),m(u(k),{type:"button",variant:"ghost",size:"sm",onClick:E(p=>_e(l),["stop"]),title:t("Copy step")},{icon:w(()=>[m(u(O),{name:"copy",class:"w-4 h-4"})]),_:2},1032,["onClick","title"]),m(u(k),{type:"button",variant:"ghost",size:"sm",onClick:E(p=>me(l),["stop"]),title:t("Edit step")},{icon:w(()=>[m(u(O),{name:"edit-2",class:"w-4 h-4"})]),_:2},1032,["onClick","title"]),m(u(k),{type:"button",variant:"ghost",size:"sm",onClick:E(p=>ue(l),["stop"]),title:t("Delete step")},{icon:w(()=>[m(u(O),{name:"trash-2",class:"w-4 h-4"})]),_:2},1032,["onClick","title"])])])])):(f(),v("div",pt,[e("div",mt,[e("h4",ut,c(t("Edit Step")),1),m(u(k),{type:"button",variant:"ghost",size:"sm",onClick:E(H,["stop"])},{icon:w(()=>[m(u(O),{name:"x",class:"w-4 h-4"})]),_:1})]),e("div",_t,[e("div",yt,[e("div",null,[e("label",gt,[C(c(t("Step Name"))+" ",1),s[21]||(s[21]=e("span",{class:"text-red-500"},"*",-1))]),m(u(K),{modelValue:r.campaign_step_name,"onUpdate:modelValue":s[5]||(s[5]=p=>r.campaign_step_name=p),type:"text",placeholder:t("Enter step name..."),disabled:b.value,class:"w-full"},null,8,["modelValue","placeholder","disabled"]),_.campaign_step_name?(f(),v("div",ft,c(_.campaign_step_name),1)):x("",!0)]),e("div",null,[e("label",vt,[C(c(t("Action Type"))+" ",1),s[22]||(s[22]=e("span",{class:"text-red-500"},"*",-1))]),m(u(Z),{type:"select",modelValue:r.action_type,"onUpdate:modelValue":s[6]||(s[6]=p=>r.action_type=p),options:ae,disabled:b.value,class:"w-full"},null,8,["modelValue","disabled"]),_.action_type?(f(),v("div",ht,c(_.action_type),1)):x("",!0)])]),e("div",null,[e("label",bt,c(t("Delay (Days)")),1),m(u(K),{modelValue:r.delay_in_days,"onUpdate:modelValue":s[7]||(s[7]=p=>r.delay_in_days=p),modelModifiers:{number:!0},type:"number",min:"0",max:"365",placeholder:t("0 for immediate execution"),disabled:b.value,class:"w-full"},null,8,["modelValue","placeholder","disabled"]),e("p",xt,c(t("Number of days to wait before executing this step")),1),_.delay_in_days?(f(),v("div",St,c(_.delay_in_days),1)):x("",!0)]),e("div",null,[e("label",wt,c(t("Template Content")),1),z(e("textarea",{"onUpdate:modelValue":s[8]||(s[8]=p=>r.template_content=p),rows:"3",placeholder:t("Enter template content for this step..."),disabled:b.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,8,kt),[[P,r.template_content]]),_.template_content?(f(),v("div",Ct,c(_.template_content),1)):x("",!0)]),e("div",null,[e("label",Tt,c(t("Action Configuration")),1),z(e("textarea",{"onUpdate:modelValue":s[9]||(s[9]=p=>r.action_config_string=p),rows:"3",placeholder:t("Enter JSON configuration..."),disabled:b.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono text-sm"},null,8,At),[[P,r.action_config_string]]),e("p",Et,c(t("JSON configuration for the action (optional)")),1),_.action_config?(f(),v("div",Vt,c(_.action_config),1)):x("",!0)]),e("div",Dt,[e("div",Mt,[e("div",Nt,[e("div",Ot,c(r.step_order),1)]),e("div",Ft,[e("p",Lt,c(t("Step Order")),1),e("p",Ut,c(t("Use Move Up/Down buttons to reorder steps")),1)])])]),e("div",jt,[m(u(k),{type:"button",variant:"outline",theme:"gray",onClick:E(H,["stop"]),disabled:b.value},{default:w(()=>[C(c(t("Cancel")),1)]),_:1},8,["disabled"]),m(u(k),{type:"button",variant:"solid",theme:"gray",onClick:E(ie,["stop"]),loading:b.value,disabled:b.value},{default:w(()=>[C(c(b.value?t("Saving..."):t("Update Step")),1)]),_:1},8,["loading","disabled"])])])]))]))),128))])),q.value&&!V.value?(f(),v("div",Bt,[e("div",$t,[e("div",It,[e("h4",zt,c(t("Add New Step")),1),m(u(k),{type:"button",variant:"ghost",size:"sm",onClick:E(H,["stop"])},{icon:w(()=>[m(u(O),{name:"x",class:"w-4 h-4"})]),_:1})]),e("div",Jt,[e("div",qt,[e("div",null,[e("label",Rt,[C(c(t("Step Name"))+" ",1),s[23]||(s[23]=e("span",{class:"text-red-500"},"*",-1))]),m(u(K),{modelValue:r.campaign_step_name,"onUpdate:modelValue":s[10]||(s[10]=l=>r.campaign_step_name=l),type:"text",placeholder:t("Enter step name..."),disabled:b.value,class:"w-full"},null,8,["modelValue","placeholder","disabled"]),_.campaign_step_name?(f(),v("div",Kt,c(_.campaign_step_name),1)):x("",!0)]),e("div",null,[e("label",Pt,[C(c(t("Action Type"))+" ",1),s[24]||(s[24]=e("span",{class:"text-red-500"},"*",-1))]),m(u(Z),{type:"select",modelValue:r.action_type,"onUpdate:modelValue":s[11]||(s[11]=l=>r.action_type=l),options:ae,disabled:b.value,class:"w-full"},null,8,["modelValue","disabled"]),_.action_type?(f(),v("div",Ht,c(_.action_type),1)):x("",!0)])]),e("div",null,[e("label",Qt,c(t("Delay (Days)")),1),m(u(K),{modelValue:r.delay_in_days,"onUpdate:modelValue":s[12]||(s[12]=l=>r.delay_in_days=l),modelModifiers:{number:!0},type:"number",min:"0",max:"365",placeholder:t("0 for immediate execution"),disabled:b.value,class:"w-full"},null,8,["modelValue","placeholder","disabled"]),e("p",Wt,c(t("Number of days to wait before executing this step")),1),_.delay_in_days?(f(),v("div",Xt,c(_.delay_in_days),1)):x("",!0)]),e("div",null,[e("label",Gt,c(t("Template Content")),1),z(e("textarea",{"onUpdate:modelValue":s[13]||(s[13]=l=>r.template_content=l),rows:"3",placeholder:t("Enter template content for this step..."),disabled:b.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,8,Yt),[[P,r.template_content]]),_.template_content?(f(),v("div",Zt,c(_.template_content),1)):x("",!0)]),e("div",null,[e("label",es,c(t("Action Configuration")),1),z(e("textarea",{"onUpdate:modelValue":s[14]||(s[14]=l=>r.action_config_string=l),rows:"3",placeholder:t("Enter JSON configuration..."),disabled:b.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono text-sm"},null,8,ts),[[P,r.action_config_string]]),e("p",ss,c(t("JSON configuration for the action (optional)")),1),_.action_config?(f(),v("div",as,c(_.action_config),1)):x("",!0)]),e("div",os,[e("div",ns,[e("div",is,[e("div",ls,c(r.step_order),1)]),e("div",rs,[e("p",cs,c(t("Step Order")),1),e("p",ds,c(t("Will be positioned as step #"+r.step_order)),1)])])]),e("div",ps,[m(u(k),{type:"button",variant:"outline",theme:"gray",onClick:E(H,["stop"]),disabled:b.value},{default:w(()=>[C(c(t("Cancel")),1)]),_:1},8,["disabled"]),m(u(k),{type:"button",variant:"solid",theme:"gray",onClick:E(ie,["stop"]),loading:b.value,disabled:b.value},{default:w(()=>[C(c(b.value?t("Saving..."):t("Add Step")),1)]),_:1},8,["loading","disabled"])])])])])):x("",!0)])):x("",!0),$.value?(f(),v("div",ms,[e("div",us,[s[25]||(s[25]=e("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),e("div",_s,[e("h3",ys,c(t("Error saving template")),1),e("div",gs,c($.value),1)])])])):x("",!0)]),e("div",fs,[m(u(k),{type:"submit",variant:"solid",theme:"gray",loading:T.value,disabled:T.value},{default:w(()=>[C(c(se.value),1)]),_:1},8,["loading","disabled"]),m(u(k),{variant:"outline",theme:"gray",onClick:G,disabled:T.value,class:"sm:mr-3"},{default:w(()=>[C(c(t("Cancel")),1)]),_:1},8,["disabled"])])],32)])])])):x("",!0)}},bs=xe(vs,[["__scopeId","data-v-d4ac4935"]]);export{bs as C,U as c};
//# sourceMappingURL=CampaignTemplateFormModal-e79aaa9f.js.map
